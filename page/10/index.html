<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">


  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-5653382914441020",
      enable_page_level_ads: true
    });
  </script>

  <meta name="google-site-verification" content="WSpJFvfcmIPBX_iK8uPbmCHIy_0f1lvd7ZJpbyad2sA">
  <meta name="yandex-verification" content="808eb057eb8396cc">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"kezunlin.me","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Kezunlin&#39;s Blog">
<meta property="og:url" content="https://kezunlin.me/page/10/index.html">
<meta property="og:site_name" content="Kezunlin&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="kezunlin">
<meta property="article:tag" content="linux, c++, python, AI, LLM">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://kezunlin.me/page/10/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Kezunlin's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Kezunlin's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Kezunlin's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Live and Learn</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://kezunlin.me/blog/linux-nm-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kezunlin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kezunlin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/linux-nm-command/" class="post-title-link" itemprop="url">linux program address space and nm command tutorial</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-31 15:54:00" itemprop="dateCreated datePublished" datetime="2018-10-31T15:54:00+08:00">2018-10-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-14 13:39:28" itemprop="dateModified" datetime="2024-10-14T13:39:28+08:00">2024-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Guide"><a href="#Guide" class="headerlink" title="Guide"></a>Guide</h2><h3 id="Linux-Unix-Address-Space"><a href="#Linux-Unix-Address-Space" class="headerlink" title="Linux&#x2F;Unix Address Space"></a>Linux&#x2F;Unix Address Space</h3><table>
<thead>
<tr>
<th align="center">memory area</th>
<th align="center">address space segment</th>
<th align="center">executable section</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Code</td>
<td align="center">Text</td>
<td align="center">.text</td>
</tr>
<tr>
<td align="center">Initialized data</td>
<td align="center">Data</td>
<td align="center">.data</td>
</tr>
<tr>
<td align="center">Zero-Initialized</td>
<td align="center">Data</td>
<td align="center">.bss</td>
</tr>
<tr>
<td align="center">Heap</td>
<td align="center">Data</td>
<td align="center">Heap</td>
</tr>
<tr>
<td align="center">Stack</td>
<td align="center">Stack</td>
<td align="center">Stack</td>
</tr>
</tbody></table>
<blockquote>
<p>BSS: Block Started by Symbol</p>
</blockquote>
<h4 id="program-memory-area"><a href="#program-memory-area" class="headerlink" title="program memory area"></a>program memory area</h4><p>program memory area: </p>
<ul>
<li>code: executable instructions （和 const 字符串常量？？？）</li>
<li>initialized-data:  static&#x2F;global 初始化不为０的</li>
<li>zero-initialized data(BSS): static&#x2F;global 初始化为０的</li>
<li>heap： malloc&#x2F;new 动态分配，大小不固定</li>
<li>stack：　非static的local variable; functin parameter; return value</li>
</ul>
<blockquote>
<p>bss它不占用程序文件的大小，但是占用程序运行时的内存空间。<br>zero-initialized data(BSS)区域的变量不占用exe的磁盘空间，其内容由操作系统初始化（清零），而initialized-data需要占用exe的磁盘空间，其内容由程序初始化<br>同一个program的N个不同process,在内存中共享同一个code&#x2F;text segment，同时都有自己的initialized-data,zero-initialized data(BSS)对应的data　segment<br>字符串常量</p>
</blockquote>
<h4 id="address-space-segment"><a href="#address-space-segment" class="headerlink" title="address space segment"></a>address space segment</h4><p>address space segment</p>
<ul>
<li>text </li>
<li>data</li>
<li>stack</li>
</ul>
<blockquote>
<ol>
<li>text,data,stack占用３块不同的地址空间。</li>
<li>initialized-data，zero-initialized data(BSS)，heap占用同一块连续的物理内存空间;</li>
<li>heap地址空间从小到大增长；stack的地址空间从大往小减小;</li>
</ol>
</blockquote>
<p>Heap，BSS，Data这三个段在物理内存中是连续存放的，可以这么理解：这三个是一体的。Text、Stack是独立存放的</p>
<h4 id="executable-file-section"><a href="#executable-file-section" class="headerlink" title="executable file section"></a>executable file section</h4><p>executable file section</p>
<ul>
<li>.text: 在进程最初被加载到内存中开始，该节的大小就被固定，只读readonly。</li>
<li>.data: 该节的大小在运行时固定的</li>
<li>.bss: 该节的大小在运行时固定的</li>
<li>heap: 从内存的低地址向高地址增长</li>
<li>stack: 从内存的高地址向低地址增长</li>
<li>.rodata: readonly data section</li>
</ul>
<p>eg</p>
<pre><code>size a.out 
   text	   data	    bss	    dec	    hex	filename
   1551	    600	     40	   2191	    88f	a.out
</code></pre>
<p>a.out加载到内存中的大小为2191 bytes.</p>
<h4 id="rodata"><a href="#rodata" class="headerlink" title="rodata"></a>rodata</h4><p>(1) const修饰的global放在.rodata, const修饰的local例外，没有放入常量区。<br>(３)对于global&#x2F;local字符串常量，编译器会去掉重复的常量，让程序的每个字符串常量只有一份，放在.rodata。（数组内容为字符串的除外）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> num = <span class="number">100</span>; <span class="comment">// .rodata </span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *str = <span class="string">&quot;123456789&quot;</span>; <span class="comment">// 123456789 ===&gt;.rodata LC0</span></span><br><span class="line"><span class="type">char</span> *str1 = <span class="string">&quot;helloworld&quot;</span>; <span class="comment">// helloworld===&gt;.rodata LC1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">　 <span class="type">const</span> <span class="type">int</span> local_num = <span class="number">99</span>; <span class="comment">// 没有放入.rodata</span></span><br><span class="line">  <span class="type">char</span>* a = <span class="string">&quot;helloworld&quot;</span>;  <span class="comment">// helloworld===&gt;.rodata LC1</span></span><br><span class="line">  <span class="type">char</span> b[<span class="number">10</span>] = <span class="string">&quot;helloworld&quot;</span>;<span class="comment">// helloworld　没有放入.rodata</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- kzl in-article ad -->
<p><ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-5653382914441020"
     data-ad-slot="7925631830"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>




<h3 id="Example-code"><a href="#Example-code" class="headerlink" title="Example code"></a>Example code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>  </span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> x + y;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="type">int</span> aaa,bbb;  <span class="comment">// auto zero-intialized(.bss)</span></span><br><span class="line"><span class="type">int</span> ccc000 = <span class="number">0</span>; <span class="comment">// auto zero-initialized(.bss)</span></span><br><span class="line"><span class="type">int</span> ccc111 = <span class="number">1</span>;  <span class="comment">// initialized(.data)</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *str1 = <span class="string">&quot;123&quot;</span>; <span class="comment">// str1---&gt;.data   123---&gt;.rodata A</span></span><br><span class="line"><span class="type">char</span> *str2 = <span class="string">&quot;xyz&quot;</span>; <span class="comment">//  str2---&gt;.data   xyz---&gt;.rodata B</span></span><br><span class="line"><span class="type">char</span> str3[] = <span class="string">&quot;abc&quot;</span>; <span class="comment">// str3---&gt;.data  </span></span><br><span class="line"><span class="type">char</span> *str4; <span class="comment">// .bss</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> hhh; <span class="comment">// .bss</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> iii00 = <span class="number">0</span>; <span class="comment">// .bss</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> iii99 = <span class="number">99</span>; <span class="comment">// .data</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> NUM99 = <span class="number">99</span>; <span class="comment">// .rodata</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> NUM00 = <span class="number">0</span>; <span class="comment">// .rodata</span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> jjj; <span class="comment">// .bss</span></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> kkk=<span class="number">1</span>; <span class="comment">// .data</span></span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> local_const00 = <span class="number">0</span>; <span class="comment">// </span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> local_const99 = <span class="number">99</span>; <span class="comment">// </span></span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> *str5 = <span class="string">&quot;xyz&quot;</span>; <span class="comment">// str5===&gt; stack,  xyz===&gt; .rodata B</span></span><br><span class="line">    <span class="type">char</span> str6[] = <span class="string">&quot;abc&quot;</span>; <span class="comment">// str6---&gt;stack,  abc ===&gt; stack</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> local = <span class="number">2</span>;  <span class="comment">// stack</span></span><br><span class="line">    <span class="type">int</span> *local_new = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">5</span>); <span class="comment">// heap</span></span><br><span class="line">    <span class="keyword">delete</span> local_new;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>

<p>output </p>
<pre><code>g++ hello.cpp
nm a.out

0000000000601078 B aaa
000000000060107c B bbb
000000000060106c B __bss_start
0000000000601080 B ccc000
0000000000601048 D ccc111
0000000000601070 b completed.7594
0000000000601038 D __data_start
0000000000601038 W data_start
00000000004005e0 t deregister_tm_clones
0000000000400660 t __do_global_dtors_aux
0000000000600e08 t __do_global_dtors_aux_fini_array_entry
0000000000601040 D __dso_handle
0000000000600e18 d _DYNAMIC
000000000060106c D _edata
00000000006010a0 B _end
00000000004007a4 T _fini
0000000000400680 t frame_dummy
0000000000600e00 t __frame_dummy_init_array_entry
0000000000400910 r __FRAME_END__
0000000000601000 d _GLOBAL_OFFSET_TABLE_
                 w __gmon_start__
00000000004007c4 r __GNU_EH_FRAME_HDR
0000000000400530 T _init
0000000000600e08 t __init_array_end
0000000000600e00 t __init_array_start
00000000004007b0 R _IO_stdin_used
                 w _ITM_deregisterTMCloneTable
                 w _ITM_registerTMCloneTable
0000000000600e10 d __JCR_END__
0000000000600e10 d __JCR_LIST__
                 w _Jv_RegisterClasses
00000000004007a0 T __libc_csu_fini
0000000000400730 T __libc_csu_init
                 U __libc_start_main@@GLIBC_2.2.5
00000000004006ba T main
0000000000400620 t register_tm_clones
                 U __stack_chk_fail@@GLIBC_2.4
00000000004005b0 T _start
0000000000601050 D str1
0000000000601058 D str2
0000000000601060 D str3
0000000000601088 B str4
0000000000601070 D __TMC_END__
00000000004006a6 T _Z3addii
                 U _ZdlPv@@GLIBCXX_3.4
0000000000601090 b _ZL3hhh
0000000000601094 b _ZL5iii00
0000000000601064 d _ZL5iii99
00000000004007c0 r _ZL5NUM00
00000000004007bc r _ZL5NUM99
                 U _Znwm@@GLIBCXX_3.4
0000000000601098 b _ZZ4mainE3jjj
0000000000601068 d _ZZ4mainE3kkk
</code></pre>
<p>other commands</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strings a.out</span><br><span class="line">readelf -s a.out</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.voidcn.com/article/p-wyahvgqg-qn.html">Linux段管理，BSS段，data段，.rodata段，text段</a></li>
<li><a target="_blank" rel="noopener" href="https://www.sanfoundry.com/c-tutorials-different-segments-program-have/">c-tutorials-different-segments-program-have</a></li>
<li><a target="_blank" rel="noopener" href="http://www.informit.com/articles/article.aspx?p=173438">Linux&#x2F;Unix process address space</a></li>
</ul>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><ul>
<li>20181031: created.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://kezunlin.me/blog/compile-darknet-on-ubuntu-16-04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kezunlin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kezunlin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/compile-darknet-on-ubuntu-16-04/" class="post-title-link" itemprop="url">compile darknet on ubuntu 16.04</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-31 12:12:00" itemprop="dateCreated datePublished" datetime="2018-10-31T12:12:00+08:00">2018-10-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-14 13:39:28" itemprop="dateModified" datetime="2024-10-14T13:39:28+08:00">2024-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/deep-learning/" itemprop="url" rel="index"><span itemprop="name">deep learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h2><ul>
<li><strong><a href="https://kezunlin.me/post/e8f8aadd/">Part 1: compile darknet on ubuntu 16.04</a></strong></li>
<li><a href="https://kezunlin.me/post/a5c428f1/">Part 2: compile darknet on windows 10</a></li>
<li><a href="https://kezunlin.me/post/cfeb28a4/">Part 3: compile caffe-yolov3 on ubuntu 16.04</a></li>
</ul>
<h2 id="Guide"><a href="#Guide" class="headerlink" title="Guide"></a>Guide</h2><p>Darknet is an open source neural network framework written in <code>C</code> and <code>CUDA</code>. It is fast, easy to install, and supports CPU and GPU computation.</p>
<p>optional dependencies:</p>
<ul>
<li>opencv</li>
<li>gpu (CUDA&#x2F;CUDNN)</li>
</ul>
<h3 id="repo-intro"><a href="#repo-intro" class="headerlink" title="repo intro"></a>repo intro</h3><p>see <a target="_blank" rel="noopener" href="https://github.com/AlexeyAB/darknet.git">darknet</a><br>This repository supports:</p>
<ul>
<li>both Windows(VS 2015 (v140)) and Linux (GCC&gt;&#x3D;4.9)</li>
<li>CPU and GPU (with CC &gt;&#x3D; 3.0)</li>
<li>both OpenCV 2.x.x and OpenCV &lt;&#x3D; 3.4.0 (3.4.1 and higher isn’t supported)</li>
<li>both cuDNN v5-v7</li>
<li>CUDA &gt;&#x3D; 7.5</li>
<li>also create SO-library on Linux and DLL-library on Windows</li>
</ul>
<h3 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h3><p>my system requirements (same as <a href="https://kezunlin.me/post/b90033a9/">caffe on ubuntu 16.04</a>)</p>
<ul>
<li>ubuntu 16.04</li>
<li>GeForce 1060 (6G)</li>
<li>cuda: 9.2 </li>
<li>cudnn: 7.1.4</li>
<li>opencv: 3.3.0 </li>
<li>openmp</li>
</ul>
<p>commands</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/AlexeyAB/darknet.git</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> darknet</span><br><span class="line">vim Makefile </span><br></pre></td></tr></table></figure>

<p>options:</p>
<pre><code>GPU=1
CUDNN=1
CUDNN_HALF=0
OPENCV=0
AVX=0
OPENMP=1
LIBSO=1
</code></pre>
<p>now compile with </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j8</span><br></pre></td></tr></table></figure>

<p> OK. now we have <code>darknet</code>, <code>darknet.so</code> and <code>uselib</code> which use <code>darknet.so</code></p>
<h4 id="fix-error"><a href="#fix-error" class="headerlink" title="fix error"></a>fix error</h4><p>CUDNN error:</p>
<pre><code>Try to load cfg: ./ped.cfg, weights: ./ped.weights, clear = 0 
   layer   filters  size/strd(dil)      input                output
   0 
 cuDNN status Error in: file: ./src/convolutional_layer.c : () : line: 301 : build time: Sep 24 2019 - 10:28:26 
cuDNN Error: CUDNN_STATUS_BAD_PARAM
</code></pre>
<p>fix </p>
<p>Makefile options:</p>
<pre><code>CUDNN=0
</code></pre>
<p>and compile again</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j8</span><br></pre></td></tr></table></figure>

<blockquote>
<p>see <a target="_blank" rel="noopener" href="https://github.com/AlexeyAB/darknet/issues/2443">here</a></p>
</blockquote>
<h3 id="pretrained-models"><a href="#pretrained-models" class="headerlink" title="pretrained models"></a>pretrained models</h3><p>dataset</p>
<ul>
<li>coco: 80 classes</li>
<li>voc: 20 classes</li>
</ul>
<p>model</p>
<ul>
<li><p>yolov3: 0-106 layers</p>
</li>
<li><p>yolov2: 0-31 layers</p>
</li>
<li><p>yolov3.cfg (236 MB COCO Yolo v3) - requires 4 GB GPU-RAM: <a target="_blank" rel="noopener" href="https://pjreddie.com/media/files/yolov3.weights">yolov3.weights</a></p>
</li>
<li><p>yolov2.cfg (194 MB COCO Yolo v2) - requires 4 GB GPU-RAM: <a target="_blank" rel="noopener" href="https://pjreddie.com/media/files/yolov2.weights">yolov2.weights</a></p>
</li>
</ul>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- kzl in-article ad -->
<p><ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-5653382914441020"
     data-ad-slot="7925631830"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>




<h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><h4 id="yolov2"><a href="#yolov2" class="headerlink" title="yolov2"></a>yolov2</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh ./image_yolov2.sh </span><br></pre></td></tr></table></figure>

<p>or </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./darknet detector <span class="built_in">test</span> ./cfg/coco.data ./cfg/yolov2.cfg ./yolov2.weights data/dog.jpg -i 0 -thresh 0.2</span><br></pre></td></tr></table></figure>

<p>output </p>
<pre><code> 29 conv   1024  3 x 3 / 1    13 x  13 x1280   -&gt;    13 x  13 x1024 3.987 BF
  30 conv    425  1 x 1 / 1    13 x  13 x1024   -&gt;    13 x  13 x 425 0.147 BF
  31 detection
mask_scale: Using default &#39;1.000000&#39;
Total BFLOPS 29.475 
Loading weights from ./yolov2.weights...
 seen 32 
Done!
data/dog.jpg: Predicted in 0.000000 milli-seconds.
dog: 79%
bicycle: 84%
truck: 77%
Not compiled with OpenCV, saving to predictions.png instead
</code></pre>
<p>view results</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eog prediction.png</span><br></pre></td></tr></table></figure>

<p><img src="https://kezunlin.me/images/posts/635233-20181101092346394-624545348.png" alt="yolov2 result"></p>
<h4 id="yolov3"><a href="#yolov3" class="headerlink" title="yolov3"></a>yolov3</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh ./image_yolov3.sh </span><br></pre></td></tr></table></figure>

<p>or </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./darknet detector <span class="built_in">test</span> ./cfg/coco.data ./cfg/yolov3.cfg ./yolov3.weights data/dog.jpg -i 0 -thresh 0.25</span><br></pre></td></tr></table></figure>

<p>output </p>
<pre><code>104 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256 1.595 BF
 105 conv    255  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 255 0.353 BF
 106 yolo
Total BFLOPS 65.864 
Loading weights from ./yolov3.weights...
 seen 64 
Done!
data/dog.jpg: Predicted in 0.000000 milli-seconds.
bicycle: 99%
dog: 100%
truck: 93%
Not compiled with OpenCV, saving to predictions.png instead
</code></pre>
<p>view results</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eog prediction.png</span><br></pre></td></tr></table></figure>

<p><img src="https://kezunlin.me/images/posts/635233-20181101092732467-1537995113.png" alt="yolov3 result"></p>
<h4 id="uselib"><a href="#uselib" class="headerlink" title="uselib"></a>uselib</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./uselib data/dog.jpg</span><br></pre></td></tr></table></figure>

<p>output </p>
<pre><code>100 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256 1.595 BF
 101 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128 0.177 BF
 102 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256 1.595 BF
 103 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128 0.177 BF
 104 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256 1.595 BF
 105 conv    255  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 255 0.353 BF
 106 yolo
Total BFLOPS 65.864 
Loading weights from yolov3.weights...
 seen 64 
Done!
object names loaded 
input image or video filename: dog - obj_id = 16,  x = 123, y = 223, w = 196, h = 319, prob = 0.998
truck - obj_id = 7,  x = 474, y = 87, w = 216, h = 78, prob = 0.931
bicycle - obj_id = 1,  x = 117, y = 124, w = 451, h = 308, prob = 0.99
</code></pre>
<h4 id="darknet-py"><a href="#darknet-py" class="headerlink" title="darknet.py"></a>darknet.py</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python darknet.py</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/pjreddie/darknet">pjreddie darknet yolo</a></li>
<li><a target="_blank" rel="noopener" href="https://pjreddie.com/darknet/install/">darknet install</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/AlexeyAB/darknet">darknet for linux and windows</a></li>
</ul>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><ul>
<li>20181031: created.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://kezunlin.me/blog/nvidia-gpu-products/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kezunlin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kezunlin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/nvidia-gpu-products/" class="post-title-link" itemprop="url">nvidia gpu products</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-29 20:29:00" itemprop="dateCreated datePublished" datetime="2018-10-29T20:29:00+08:00">2018-10-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-14 13:39:28" itemprop="dateModified" datetime="2024-10-14T13:39:28+08:00">2024-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/deep-learning/" itemprop="url" rel="index"><span itemprop="name">deep learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Guide"><a href="#Guide" class="headerlink" title="Guide"></a>Guide</h2><blockquote>
<p>from <a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-gpus">cuda-gpus</a></p>
</blockquote>
<h3 id="Tesla"><a href="#Tesla" class="headerlink" title="Tesla"></a>Tesla</h3><p><img src="https://kezunlin.me/images/posts/635233-20181029183548631-1057913795.png" alt="tesla"></p>
<h3 id="Quadro"><a href="#Quadro" class="headerlink" title="Quadro"></a>Quadro</h3><p><img src="https://kezunlin.me/images/posts/635233-20181029183552631-1761856836.png" alt="Quadro"></p>
<h3 id="NVS"><a href="#NVS" class="headerlink" title="NVS"></a>NVS</h3><p><img src="https://kezunlin.me/images/posts/635233-20181029183604602-1639202810.png" alt="NVS"></p>
<h3 id="GeForce"><a href="#GeForce" class="headerlink" title="GeForce"></a>GeForce</h3><p><img src="https://kezunlin.me/images/posts/635233-20181029183608854-55804981.png" alt="GeForce"></p>
<h3 id="TEGRA-Jetson"><a href="#TEGRA-Jetson" class="headerlink" title="TEGRA&#x2F;Jetson"></a>TEGRA&#x2F;Jetson</h3><p><img src="https://kezunlin.me/images/posts/635233-20190422151846066-500787709.png" alt="TEGRA/ Jetson"></p>
<h4 id="jetson-products"><a href="#jetson-products" class="headerlink" title="jetson products"></a>jetson products</h4><ul>
<li>Jetson TX1   (fp32,fp16)</li>
<li>Jetson TX2    (fp32,fp16)</li>
<li>Jetson AGX Xavier (fp32,fp16,int8,dla)</li>
<li>Jetson Nano (Jetbot)</li>
</ul>
<p>hardware precision support matrix<br><img src="https://kezunlin.me/images/posts/635233-20190422151849087-402485522.png" alt="hardware precision support matrix"></p>
<blockquote>
<p>see <a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/sdk/tensorrt-support-matrix/index.html#hardware-precision-matrix">tensorrt-support-matrix</a></p>
</blockquote>
<blockquote>
<p>Xaiver: 30W,性能和能效分别比前代产品 NVIDIA Jetson TX2 高出 20 倍和 10 倍</p>
</blockquote>
<h4 id="JetPack-SDK"><a href="#JetPack-SDK" class="headerlink" title="JetPack SDK"></a>JetPack SDK</h4><p><a target="_blank" rel="noopener" href="https://developer.nvidia.com/embedded/jetpack">Jetson Development Pack (JetPack SDK)</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.nvidia.com/jetson/archives/jetpack-archived/jetpack-411/index.html#jetpack/4.1.1/introduction.htm%3FTocPath%3D_____1">JetPack 4.1.1 Developer Preview </a></p>
<p>JetPack Components</p>
<ul>
<li>OS Image: JetPack includes a sample file system derived from Ubuntu.</li>
<li>Libraries: CUDA&#x2F;CUDNN&#x2F;TensorRT&#x2F;MultiMedia API&#x2F;VisionWorks and OpenCV</li>
<li>Developer Tools: CUDA tools&#x2F;NVIDIA Nsight Systems&#x2F;NVIDIA Nsight Graphics</li>
<li>Samples </li>
<li>Documents</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://docs.nvidia.com/jetson/jetpack/index.html#jetpack/4.1.1/install.htm%3FTocPath%3D_____3">JetPack Installer</a></p>
<blockquote>
<p>JetPack 4.1.1<br>Now supports Host computer running Ubuntu 18.04 or Ubuntu 16.04.<br>JetPack installer can now share host computer’s internet connection to Jetson device via USB Type C cable during install.</p>
</blockquote>
<p>Jetson DeepStream SDK</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-gpus">cuda gpus</a></li>
<li><a target="_blank" rel="noopener" href="https://www.nvidia.com/drivers">drivers</a></li>
<li><a target="_blank" rel="noopener" href="https://www.nvidia.com/zh-cn/autonomous-machines/embedded-systems-dev-kits-modules/">Jetson AGX Xavier</a></li>
</ul>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><ul>
<li>20181029: created.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://kezunlin.me/blog/python-iterator-and-generator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kezunlin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kezunlin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/python-iterator-and-generator/" class="post-title-link" itemprop="url">python iterator and generator</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-29 15:48:00" itemprop="dateCreated datePublished" datetime="2018-10-29T15:48:00+08:00">2018-10-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-14 13:39:28" itemprop="dateModified" datetime="2024-10-14T13:39:28+08:00">2024-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Iterable-Iterator"><a href="#Iterable-Iterator" class="headerlink" title="Iterable &amp;&amp; Iterator"></a>Iterable &amp;&amp; Iterator</h2><ul>
<li><p>可迭代对象（iterable），只定义了<code>__iter__</code>方法； 字符串、列表、元组、字典、文件；可以通过<code>iter(iterable)</code>方法获取iterator对象，也可以通过<code>list(iterable)</code> <code>for xxx in iterable</code>间接调用<code>__iter__</code>方法</p>
</li>
<li><p>迭代器（iterator）， Iteration Protocol: 定义了<code>__iter__</code>和<code>__next__</code>两个方法，<code>__iter__</code>返回迭代器本身(用于for loop)，<code>__next__</code>方法返回下一个元素，如果没有元素了，抛出StopIteration异常； for python2, use <code>next</code>; for python3, use <code>__next__</code></p>
<pre><code>iterator = iter(l) #
iterator2 = l.__iter__() 

list(l)
for xxx in l:
</code></pre>
</li>
</ul>
<h3 id="yrange"><a href="#yrange" class="headerlink" title="yrange"></a>yrange</h3><p>例子1：iterable和iterator是同一个对象。</p>
<pre><code>y = iterable()
list(y) 
list(y)
for i in y
</code></pre>
<blockquote>
<p>只有第一次输出所有值；后续输出未空。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">yrange</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="variable language_">self</span>.i = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.n = n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;__iter__1&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.i &lt; <span class="variable language_">self</span>.n:</span><br><span class="line">            i = <span class="variable language_">self</span>.i</span><br><span class="line">            <span class="variable language_">self</span>.i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration()</span><br></pre></td></tr></table></figure>

<p>当使用<code>list(iterable)</code>的时候，会调用iterable的<code>__iter__</code>方法返回iterator</p>
<p>output </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">y = yrange(<span class="number">3</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line">y = yrange(<span class="number">3</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line">y = yrange(<span class="number">3</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line">y = yrange(<span class="number">3</span>)</span><br><span class="line">StopIteration </span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>(yrange(<span class="number">3</span>))</span><br><span class="line">__iter__1</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span>(yrange(<span class="number">3</span>))</span><br><span class="line">__iter__1</span><br><span class="line"><span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">y = yrange(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>(y)</span><br><span class="line">__iter__1</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>(y)</span><br><span class="line">__iter__1</span><br><span class="line">    []</span><br><span class="line">    </span><br><span class="line">y = yrange(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>(y.__iter__())</span><br><span class="line">__iter__1</span><br><span class="line">__iter__1</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>(y.__iter__())</span><br><span class="line">__iter__1</span><br><span class="line">__iter__1</span><br><span class="line">    []</span><br></pre></td></tr></table></figure>

<h3 id="zrange"><a href="#zrange" class="headerlink" title="zrange"></a>zrange</h3><p>例子2：iterable和iterator是不同对象。</p>
<pre><code>z = iterable()
list(z)
list(z)
for i in z
</code></pre>
<p>调用N次，都会输出所有值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">zrange</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="variable language_">self</span>.n = n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;__iter__1&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> zrange_iter(<span class="variable language_">self</span>.n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">zrange_iter</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="variable language_">self</span>.i = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.n = n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;__iter__2&quot;</span>)</span><br><span class="line">        <span class="comment"># Iterators are iterables too.</span></span><br><span class="line">        <span class="comment"># Adding this functions to make them so.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.i &lt; <span class="variable language_">self</span>.n:</span><br><span class="line">            i = <span class="variable language_">self</span>.i</span><br><span class="line">            <span class="variable language_">self</span>.i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration()</span><br></pre></td></tr></table></figure>

<p>output</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">z = zrange(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">list</span>(z)</span><br><span class="line">__iter__1</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>(z)</span><br><span class="line">__iter__1</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">z = zrange(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">list</span>(z.__iter__())</span><br><span class="line">__iter__1</span><br><span class="line">__iter__2</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>(z.__iter__())</span><br><span class="line">__iter__1</span><br><span class="line">__iter__2</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- kzl in-article ad -->
<p><ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-5653382914441020"
     data-ad-slot="7925631830"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h2><p><code>Generator functions</code> are ordinary functions defined using <code>yield</code> instead of <code>return</code>. When called, a <code>generator function</code> returns a <code>generator object</code>, which is a kind of <code>iterator</code> - it has a <code>next()</code> method. When you call <code>next()</code>, the next value yielded by the generator function is returned.</p>
<blockquote>
<p>use the word “generator” to mean the genearted object and “generator function” to mean the function that generates it.</p>
</blockquote>
<p>generator也是一个iterator。 <code>Generator functions</code>简化了<code>iterator</code>的创建。只需要yield就可以代替实现iterator的<code>__iter__</code>和<code>next</code>方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">yrange</span>(<span class="params">n</span>):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; n:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>output </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = yrange(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y</span><br><span class="line">&lt;generator <span class="built_in">object</span> yrange at <span class="number">0x401f30</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y.<span class="built_in">next</span>()</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y.<span class="built_in">next</span>()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y.<span class="built_in">next</span>()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y.<span class="built_in">next</span>()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure>

<h3 id="How-to-work"><a href="#How-to-work" class="headerlink" title="How to work"></a>How to work</h3><p>When a <code>generator function</code> is called, it returns a <code>generator object</code> without even beginning execution of the function.<br>When <code>next</code> method is called for the first time, the function starts executing until it reaches <code>yield</code> statement. The yielded value is returned by the <code>next</code> call.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span> <span class="string">&quot;begin&quot;</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span> <span class="string">&quot;before yield&quot;</span>, i</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">yield</span> i</span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span> <span class="string">&quot;after yield&quot;</span>, i</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span> <span class="string">&quot;end&quot;</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = foo() <span class="comment"># 不执行任何语句，返回generator object</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.<span class="built_in">next</span>() <span class="comment"># 执行语句直到yield,返回结果</span></span><br><span class="line">begin</span><br><span class="line">before <span class="keyword">yield</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.<span class="built_in">next</span>() <span class="comment"># 从上一次yield语句的下一句开始执行语句直到再次到达yield,返回结果</span></span><br><span class="line">after <span class="keyword">yield</span> <span class="number">0</span></span><br><span class="line">before <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.<span class="built_in">next</span>() <span class="comment"># 从上一次yield语句的下一句开始执行语句直到再次到达yield,返回结果</span></span><br><span class="line">after <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">before <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.<span class="built_in">next</span>() <span class="comment"># 从上一次yield语句的下一句开始执行语句，由于没有再次到达yield所以抛出StopIteration异常</span></span><br><span class="line">after <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">end</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>再看一下例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">integers</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Infinite sequence of integers.&quot;&quot;&quot;</span></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">squares</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> integers():</span><br><span class="line">        <span class="keyword">yield</span> i * i</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">take</span>(<span class="params">n, seq</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Returns first n values from the given sequence.&quot;&quot;&quot;</span></span><br><span class="line">    seq = <span class="built_in">iter</span>(seq)</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            result.append(seq.<span class="built_in">next</span>())</span><br><span class="line">    <span class="keyword">except</span> StopIteration:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> take(<span class="number">5</span>, squares()) <span class="comment"># prints [1, 4, 9, 16, 25]</span></span><br></pre></td></tr></table></figure>

<h3 id="Generator-Expressions"><a href="#Generator-Expressions" class="headerlink" title="Generator Expressions"></a>Generator Expressions</h3><p>Generator Expressions are generator version of <code>list comprehensions</code>.<br>They look like list comprehensions, but returns a generator back instead of a list.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">a = [x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">a</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = (x*x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>))</span><br><span class="line">a</span><br><span class="line">&lt;generator <span class="built_in">object</span> &lt;genexpr&gt; at <span class="number">0x0000000005232630</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span>(a)</span><br><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span>((x*x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)))</span><br><span class="line"><span class="comment">#如果只有一个参数，generator expression的()可以省略</span></span><br><span class="line"><span class="built_in">sum</span>(x*x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">pyt = ((x, y, z) <span class="keyword">for</span> z <span class="keyword">in</span> integers() </span><br><span class="line">                    <span class="keyword">for</span> y <span class="keyword">in</span> xrange(<span class="number">1</span>, z) </span><br><span class="line">                            <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, y) </span><br><span class="line">                                <span class="keyword">if</span> x*x + y*y == z*z)</span><br><span class="line"></span><br><span class="line">pyt</span><br><span class="line">&lt;generator <span class="built_in">object</span> &lt;genexpr&gt; at <span class="number">0x0000000005232828</span>&gt;</span><br><span class="line"></span><br><span class="line">take(<span class="number">5</span>,pyt)</span><br><span class="line">[(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>), (<span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>), (<span class="number">5</span>, <span class="number">12</span>, <span class="number">13</span>), (<span class="number">9</span>, <span class="number">12</span>, <span class="number">15</span>), (<span class="number">8</span>, <span class="number">15</span>, <span class="number">17</span>)]</span><br></pre></td></tr></table></figure>

<h3 id="Example-Reading-multiple-files"><a href="#Example-Reading-multiple-files" class="headerlink" title="Example: Reading multiple files"></a>Example: Reading multiple files</h3><p>python提供的file对象就是一个iterator对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;./1.txt&#x27;</span>)</span><br><span class="line">f.<span class="built_in">next</span>()</span><br><span class="line">f.<span class="built_in">next</span>()</span><br></pre></td></tr></table></figure>

<p>使用generator简化代码<br>old</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cat</span>(<span class="params">filenames</span>):</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> filenames:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(f):</span><br><span class="line">            <span class="built_in">print</span> line,</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">grep</span>(<span class="params">pattern, filenames</span>):</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> filenames:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(f):</span><br><span class="line">            <span class="keyword">if</span> pattern <span class="keyword">in</span> line:</span><br><span class="line">                <span class="built_in">print</span> line,</span><br></pre></td></tr></table></figure>

<p>new with generator</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">readfiles</span>(<span class="params">filenames</span>):</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> filenames:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(f):</span><br><span class="line">            <span class="keyword">yield</span> line</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">grep</span>(<span class="params">pattern, lines</span>):</span><br><span class="line">    <span class="keyword">return</span> (line <span class="keyword">for</span> line <span class="keyword">in</span> lines <span class="keyword">if</span> pattern <span class="keyword">in</span> line)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">printlines</span>(<span class="params">lines</span>):</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="built_in">print</span> line,</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">pattern, filenames</span>):</span><br><span class="line">    lines = readfiles(filenames)</span><br><span class="line">    lines = grep(pattern, lines)</span><br><span class="line">    printlines(lines)</span><br></pre></td></tr></table></figure>

<h2 id="Itertools"><a href="#Itertools" class="headerlink" title="Itertools"></a>Itertools</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">it1 = <span class="built_in">iter</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">it2 = <span class="built_in">iter</span>([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> itertools.chain(it1, it2):</span><br><span class="line">    <span class="built_in">print</span> v</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x, y <span class="keyword">in</span> itertools.izip([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]:</span><br><span class="line">    <span class="built_in">print</span> x, y</span><br><span class="line"></span><br><span class="line"><span class="comment">#a 1</span></span><br><span class="line"><span class="comment">#b 2</span></span><br><span class="line"><span class="comment">#c 3</span></span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://anandology.com/python-practice-book/iterators.html">iterators</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2776829/difference-between-pythons-generators-and-iterators">difference-between-pythons-generators-and-iterators</a></li>
</ul>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><ul>
<li>20181029: created.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://kezunlin.me/blog/compile-protobuf-cpp-on-windows-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kezunlin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kezunlin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/compile-protobuf-cpp-on-windows-10/" class="post-title-link" itemprop="url">compile and install protobuf-cpp on windows 10</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-29 11:30:00" itemprop="dateCreated datePublished" datetime="2018-10-29T11:30:00+08:00">2018-10-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-14 13:39:28" itemprop="dateModified" datetime="2024-10-14T13:39:28+08:00">2024-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/cpp/" itemprop="url" rel="index"><span itemprop="name">cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h2><ul>
<li><a href="https://kezunlin.me/post/d60ff6fe/">Part 1: compile protobuf-cpp on ubuntu 16.04</a></li>
<li><strong><a href="https://kezunlin.me/post/876d75f2/">Part 2: compile protobuf-cpp on windows 10</a></strong></li>
<li><a href="https://kezunlin.me/post/ba8b6dea/">Part 3: protobuf usage</a></li>
</ul>
<h2 id="Guide"><a href="#Guide" class="headerlink" title="Guide"></a>Guide</h2><h3 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/protocolbuffers/protobuf.git     </span><br><span class="line"><span class="built_in">cd</span> protobuf</span><br><span class="line">git submodule update --init --recursive</span><br><span class="line"><span class="comment"># third_party/benchmark third_party/googletest</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> cmake &amp;&amp; <span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build &amp;&amp; cmake-gui ..</span><br></pre></td></tr></table></figure>

<p>with options</p>
<pre><code>CMAKE_INSTALL_PREFIX C:/Program Files/protobuf
protobuf_BUILD_SHARED_LIBS ON
</code></pre>
<p>Static Linking vs DLL</p>
<blockquote>
<p><code>Static linking</code> is now the default for the Protocol Buffer libraries. Due to issues with Win32’s use of a separate heap for each DLL, as well as binary compatibility issues between different versions of MSVC’s STL library, it is recommended that you use static linkage only.<br>However, it is possible to build libprotobuf and libprotoc as DLLs if you really want. To do this, do the following:</p>
</blockquote>
<ul>
<li>Add an additional flag <code>-Dprotobuf_BUILD_SHARED_LIBS=ON</code> when invoking cmake</li>
<li>Follow the same steps as described in the above section.</li>
<li>When compiling your project, make sure to <code>#define PROTOBUF_USE_DLLS</code>.</li>
</ul>
<p>compile <code>ALL_BUILD</code> with <code>VS 2015</code> and install to <code>C:/Program Files/protobuf</code> with dynamic libraries.</p>
<h3 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protoc --cpp_out=. ./point_cloud.proto </span><br><span class="line">protoc --java_out=./java/ ./proto/helloworld.proto</span><br><span class="line">protoc --go_out=./go/ ./proto/helloworld.proto</span><br></pre></td></tr></table></figure>

<h3 id="CMakeLists-txt"><a href="#CMakeLists-txt" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Protobuf REQUIRED)</span><br><span class="line"><span class="keyword">add_definitions</span>( -DPROTOBUF_USE_DLLS ) </span><br><span class="line"><span class="keyword">MESSAGE</span>( [Main] <span class="string">&quot; PROTOBUF_INCLUDE_DIRS = $&#123;PROTOBUF_INCLUDE_DIRS&#125;&quot;</span>)   </span><br><span class="line"><span class="keyword">MESSAGE</span>( [Main] <span class="string">&quot; PROTOBUF_LIBRARIES = $&#123;PROTOBUF_LIBRARIES&#125;&quot;</span>)  </span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/protocolbuffers/protobuf/blob/master/cmake/README.md">protobuf on windows</a></li>
</ul>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><ul>
<li>20181029: created.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://kezunlin.me/blog/tensorflow-introduction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kezunlin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kezunlin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/tensorflow-introduction/" class="post-title-link" itemprop="url">tensorflow basic introduction</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-26 18:32:00" itemprop="dateCreated datePublished" datetime="2018-10-26T18:32:00+08:00">2018-10-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-14 13:39:28" itemprop="dateModified" datetime="2024-10-14T13:39:28+08:00">2024-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/deep-learning/" itemprop="url" rel="index"><span itemprop="name">deep learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Set-up"><a href="#Set-up" class="headerlink" title="Set up"></a>Set up</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import</span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br></pre></td></tr></table></figure>

<h2 id="Tensor-Values"><a href="#Tensor-Values" class="headerlink" title="Tensor Values"></a>Tensor Values</h2><p> <code>tensor</code>, <code>rank</code>, <code>shape</code>, <code>value</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="comment"># a rank 0 tensor; a scalar with shape [],</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>] <span class="comment"># a rank 1 tensor; a vector with shape [3]</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>], </span><br><span class="line"> [<span class="number">4.</span>, <span class="number">5.</span>, <span class="number">6.</span>]] <span class="comment"># a rank 2 tensor; a matrix with shape [2, 3]</span></span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">    [[<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>]], </span><br><span class="line">     [[<span class="number">7.</span>, <span class="number">8.</span>, <span class="number">9.</span>]]</span><br><span class="line">] <span class="comment"># a rank 3 tensor with shape [2, 1, 3]</span></span><br></pre></td></tr></table></figure>




<pre><code>[[[1.0, 2.0, 3.0]], [[7.0, 8.0, 9.0]]]
</code></pre>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- kzl in-article ad -->
<p><ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-5653382914441020"
     data-ad-slot="7925631830"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>




<h2 id="TensorFlow-Core-Walkthrough"><a href="#TensorFlow-Core-Walkthrough" class="headerlink" title="TensorFlow Core Walkthrough"></a>TensorFlow Core Walkthrough</h2><p>You might think of TensorFlow Core programs as consisting of two discrete sections:</p>
<ul>
<li>Building the computational graph (a <code>tf.Graph</code>).</li>
<li>Running the computational graph (using a <code>tf.Session</code>).</li>
</ul>
<h3 id="Graph"><a href="#Graph" class="headerlink" title="Graph"></a>Graph</h3><p>A <code>computational graph</code> is a series of TensorFlow operations arranged into a graph. The graph is composed of two types of objects.</p>
<ul>
<li><code>tf.Operation</code> (or “ops”): The nodes of the graph. Operations describe calculations that consume and produce tensors.</li>
<li><code>tf.Tensor</code>: The edges in the graph. These represent the values that will flow through the graph. Most TensorFlow functions return tf.Tensors.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tf.Tensors do not have values</span></span><br><span class="line"></span><br><span class="line">a = tf.constant(<span class="number">3.0</span>, dtype=tf.float32)</span><br><span class="line">b = tf.constant(<span class="number">4.0</span>) <span class="comment"># also tf.float32 implicitly</span></span><br><span class="line">total = a + b</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="built_in">print</span>(total)</span><br></pre></td></tr></table></figure>

<pre><code>Tensor(&quot;Const_4:0&quot;, shape=(), dtype=float32)
Tensor(&quot;Const_5:0&quot;, shape=(), dtype=float32)
Tensor(&quot;add_2:0&quot;, shape=(), dtype=float32)
</code></pre>
<h4 id="TensorBoard"><a href="#TensorBoard" class="headerlink" title="TensorBoard"></a>TensorBoard</h4><p>visualizing a computation graph.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">writer = tf.summary.FileWriter(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">writer.add_graph(tf.get_default_graph()) <span class="comment"># events.out.tfevents.&#123;timestamp&#125;.&#123;hostname&#125;</span></span><br></pre></td></tr></table></figure>

<p>Now, in a new terminal, launch TensorBoard with the following shell command:</p>
<pre><code>tensorboard --logdir .
</code></pre>
<p>then access <code>http://localhost:6006/#graphs</code></p>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>To evaluate tensors, instantiate a <code>tf.Session</code> object, informally known as a <code>session</code>. A session encapsulates the state of the TensorFlow runtime, and runs TensorFlow operations. If a <code>tf.Graph</code> is like a <code>.py</code> file, a <code>tf.Session</code> is like the <code>python executable</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sess = tf.Session()</span><br><span class="line"><span class="built_in">print</span>(sess.run(total))</span><br></pre></td></tr></table></figure>

<pre><code>7.0
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(sess.run(&#123;<span class="string">&#x27;ab&#x27;</span>:(a, b), <span class="string">&#x27;total&#x27;</span>:total&#125;))</span><br></pre></td></tr></table></figure>

<pre><code>&#123;&#39;total&#39;: 7.0, &#39;ab&#39;: (3.0, 4.0)&#125;
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一次，第二次run的vec结果都不一样；第三次先生成vec，然后得到out1和out2</span></span><br><span class="line">vec = tf.random_uniform(shape=(<span class="number">3</span>,))</span><br><span class="line">out1 = vec + <span class="number">1</span></span><br><span class="line">out2 = vec + <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(sess.run(vec))</span><br><span class="line"><span class="built_in">print</span>(sess.run(vec))</span><br><span class="line"><span class="built_in">print</span>(sess.run((out1, out2)))</span><br></pre></td></tr></table></figure>

<pre><code>[0.3936273  0.7793083  0.46128905]
[0.9422312  0.03195083 0.4434662 ]
(array([1.9042395, 1.5705729, 1.4484392], dtype=float32), array([2.9042397, 2.5705729, 2.4484391], dtype=float32))
</code></pre>
<h3 id="Feeding"><a href="#Feeding" class="headerlink" title="Feeding"></a>Feeding</h3><p> A <code>placeholder</code> is a promise to provide a value later, like a function argument.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = tf.placeholder(tf.float32)</span><br><span class="line">y = tf.placeholder(tf.float32)</span><br><span class="line">z = x + y</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="built_in">print</span>(y)</span><br><span class="line"><span class="built_in">print</span>(z)</span><br></pre></td></tr></table></figure>

<pre><code>Tensor(&quot;Placeholder_2:0&quot;, dtype=float32)
Tensor(&quot;Placeholder_3:0&quot;, dtype=float32)
Tensor(&quot;add_6:0&quot;, dtype=float32)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(sess.run(z, feed_dict=&#123;x: <span class="number">3</span>, y: <span class="number">4.5</span>&#125;))</span><br><span class="line"><span class="built_in">print</span>(sess.run(z, feed_dict=&#123;x: [<span class="number">1</span>, <span class="number">3</span>], y: [<span class="number">2</span>, <span class="number">4</span>]&#125;))</span><br></pre></td></tr></table></figure>

<pre><code>7.5
[3. 7.]
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># placeholders throw an error if no value is fed to them.</span></span><br><span class="line"><span class="comment"># print(sess.run(z))</span></span><br></pre></td></tr></table></figure>

<h2 id="Datasets"><a href="#Datasets" class="headerlink" title="Datasets"></a>Datasets</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">my_data = [</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>,],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">3</span>,],</span><br><span class="line">    [<span class="number">4</span>, <span class="number">5</span>,],</span><br><span class="line">    [<span class="number">6</span>, <span class="number">7</span>,],</span><br><span class="line">]</span><br><span class="line">slices = tf.data.Dataset.from_tensor_slices(my_data)</span><br><span class="line">next_item = slices.make_one_shot_iterator().get_next()</span><br></pre></td></tr></table></figure>

<p>Reaching the end of the data stream causes <code>Dataset</code> to throw an <code>tf.errors.OutOfRangeError</code>. For example, the following code reads the <code>next_item</code> until there is no more data to read:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(sess.run(next_item))</span><br><span class="line">  <span class="keyword">except</span> tf.errors.OutOfRangeError:</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<pre><code>[0 1]
[2 3]
[4 5]
[6 7]
</code></pre>
<p>If the <code>Dataset</code> depends on stateful operations you may need to initialize the iterator before using it, as shown below:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">r = tf.random_normal([<span class="number">10</span>,<span class="number">3</span>])</span><br><span class="line">dataset = tf.data.Dataset.from_tensor_slices(r)</span><br><span class="line">iterator = dataset.make_initializable_iterator()</span><br><span class="line">next_row = iterator.get_next()</span><br><span class="line"></span><br><span class="line">sess.run(iterator.initializer) <span class="comment"># initialize iterator</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(sess.run(next_row))</span><br><span class="line">  <span class="keyword">except</span> tf.errors.OutOfRangeError:</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<pre><code>[-0.27240568  0.41916385  0.8312674 ]
[-0.37411043  0.39321673  0.44852588]
[-2.502281   -0.35216704 -0.42525485]
[ 0.16175386  0.4726008  -0.02786499]
[-0.252643    0.47525632  1.3186764 ]
[ 0.2424109  1.3193169 -0.4673948]
[ 0.43207827  0.31257248 -0.609174  ]
[-0.80196303 -1.100821    2.44067   ]
[0.79778594 0.34206432 1.0677754 ]
[ 0.47419003 -0.7259666   0.8751686 ]
</code></pre>
<h2 id="Layers"><a href="#Layers" class="headerlink" title="Layers"></a>Layers</h2><h3 id="Creating-Layers"><a href="#Creating-Layers" class="headerlink" title="Creating Layers"></a>Creating Layers</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = tf.placeholder(tf.float32, shape=[<span class="literal">None</span>, <span class="number">3</span>])</span><br><span class="line">linear_model = tf.layers.Dense(units=<span class="number">1</span>) <span class="comment"># Layer</span></span><br><span class="line">y = linear_model(x)</span><br></pre></td></tr></table></figure>

<h3 id="Initializing-Layers"><a href="#Initializing-Layers" class="headerlink" title="Initializing Layers"></a>Initializing Layers</h3><p>The layer contains variables that must be initialized before they can be used. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">init = tf.global_variables_initializer()</span><br><span class="line">sess.run(init)</span><br></pre></td></tr></table></figure>

<h3 id="Executing-Layers"><a href="#Executing-Layers" class="headerlink" title="Executing Layers"></a>Executing Layers</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(sess.run(y, &#123;x: [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]]&#125;))</span><br></pre></td></tr></table></figure>

<pre><code>[[ 4.5850883]
 [10.428741 ]]
</code></pre>
<h3 id="Layer-Function-shortcuts"><a href="#Layer-Function-shortcuts" class="headerlink" title="Layer Function shortcuts"></a>Layer Function shortcuts</h3><p>For each layer class (like <code>tf.layers.Dense</code>) TensorFlow also supplies a shortcut function (like <code>tf.layers.dense</code>). </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = tf.placeholder(tf.float32, shape=[<span class="literal">None</span>, <span class="number">3</span>])</span><br><span class="line">y = tf.layers.dense(x, units=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line">sess.run(init)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sess.run(y, &#123;x: [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]]&#125;))</span><br></pre></td></tr></table></figure>

<pre><code>[[2.4798913]
 [6.7798343]]
</code></pre>
<h2 id="Feature-columns"><a href="#Feature-columns" class="headerlink" title="Feature columns"></a>Feature columns</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">features = &#123;</span><br><span class="line">    <span class="string">&#x27;sales&#x27;</span> : [[<span class="number">5</span>], [<span class="number">10</span>], [<span class="number">8</span>], [<span class="number">9</span>]],</span><br><span class="line">    <span class="string">&#x27;department&#x27;</span>: [<span class="string">&#x27;sports&#x27;</span>, <span class="string">&#x27;sports&#x27;</span>, <span class="string">&#x27;gardening&#x27;</span>, <span class="string">&#x27;gardening&#x27;</span>]&#125;</span><br><span class="line"></span><br><span class="line">department_column = tf.feature_column.categorical_column_with_vocabulary_list(</span><br><span class="line">        <span class="string">&#x27;department&#x27;</span>, [<span class="string">&#x27;sports&#x27;</span>, <span class="string">&#x27;gardening&#x27;</span>])</span><br><span class="line">department_column = tf.feature_column.indicator_column(department_column)</span><br><span class="line"><span class="built_in">print</span>(department_column)</span><br><span class="line"></span><br><span class="line">columns = [</span><br><span class="line">    tf.feature_column.numeric_column(<span class="string">&#x27;sales&#x27;</span>),</span><br><span class="line">    department_column</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">inputs = tf.feature_column.input_layer(features, columns)</span><br><span class="line"><span class="built_in">print</span>(inputs)</span><br></pre></td></tr></table></figure>

<pre><code>_IndicatorColumn(categorical_column=_VocabularyListCategoricalColumn(key=&#39;department&#39;, vocabulary_list=(&#39;sports&#39;, &#39;gardening&#39;), dtype=tf.string, default_value=-1, num_oov_buckets=0))
Tensor(&quot;input_layer/concat:0&quot;, shape=(4, 3), dtype=float32)
</code></pre>
<p>Running the inputs tensor will parse the features into a batch of vectors.</p>
<p>Feature columns can have internal state, like layers, so they often need to be initialized. Categorical columns use <code>tf.contrib.lookup</code> internally and these require a separate initialization op, <code>tf.tables_initializer</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var_init = tf.global_variables_initializer()</span><br><span class="line">table_init = tf.tables_initializer()</span><br><span class="line">sess = tf.Session()</span><br><span class="line">sess.run((var_init, table_init))</span><br></pre></td></tr></table></figure>




<pre><code>(None, None)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(sess.run(inputs))</span><br></pre></td></tr></table></figure>

<pre><code>[[ 1.  0.  5.]
 [ 1.  0. 10.]
 [ 0.  1.  8.]
 [ 0.  1.  9.]]
</code></pre>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- kzl in-article ad -->
<p><ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-5653382914441020"
     data-ad-slot="7925631830"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>



<h2 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h2><h3 id="Define-the-data"><a href="#Define-the-data" class="headerlink" title="Define the data"></a>Define the data</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = tf.constant([[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>], [<span class="number">4</span>]], dtype=tf.float32)</span><br><span class="line">y_true = tf.constant([[<span class="number">0</span>], [-<span class="number">1</span>], [-<span class="number">2</span>], [-<span class="number">3</span>]], dtype=tf.float32)</span><br></pre></td></tr></table></figure>

<h3 id="Define-the-model"><a href="#Define-the-model" class="headerlink" title="Define the model"></a>Define the model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">linear_model = tf.layers.Dense(units=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">y_pred = linear_model(x)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sess = tf.Session()</span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line">sess.run(init)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The model hasn&#x27;t yet been trained, so the four &quot;predicted&quot; values aren&#x27;t very good. </span></span><br><span class="line"><span class="comment"># Here&#x27;s what we got; your own output will almost certainly differ:</span></span><br><span class="line"><span class="built_in">print</span>(sess.run(y_pred))</span><br></pre></td></tr></table></figure>

<pre><code>[[0.5062338]
 [1.0124676]
 [1.5187014]
 [2.0249352]]
</code></pre>
<h3 id="Loss"><a href="#Loss" class="headerlink" title="Loss"></a>Loss</h3><p>To optimize a model, you first need to define the loss. We’ll use the mean square error (<code>MSE</code>), a standard loss for regression problems.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">loss = tf.losses.mean_squared_error(labels=y_true, predictions=y_pred)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sess.run(loss))</span><br></pre></td></tr></table></figure>

<pre><code>10.484383
</code></pre>
<h3 id="Training-1"><a href="#Training-1" class="headerlink" title="Training"></a>Training</h3><p>TensorFlow provides optimizers implementing standard optimization algorithms. These are implemented as sub-classes of <code>tf.train.Optimizer</code>. They incrementally change each variable in order to minimize the loss. The simplest optimization algorithm is gradient descent, implemented by <code>tf.train.GradientDescentOptimizer</code>. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">optimizer = tf.train.GradientDescentOptimizer(<span class="number">0.01</span>)</span><br><span class="line">train = optimizer.minimize(loss) <span class="comment"># training operation</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">  _, loss_value = sess.run((train, loss))</span><br><span class="line">  <span class="built_in">print</span>(loss_value)</span><br></pre></td></tr></table></figure>

<pre><code>10.484383
7.366995
5.2033534
3.7015016
2.6588542
1.9348423
1.4319282
1.0824323
0.83939326
0.67022556
0.5523189
0.46998408
0.41233516
0.37181824
0.34319195
0.32281947
0.30817705
0.29751378
0.28961438
0.2836359
0.27899322
0.2752804
0.27221578
0.26960373
0.26730868
0.2652365
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(sess.run(y_pred))</span><br></pre></td></tr></table></figure>

<pre><code>[[-0.66274  ]
 [-1.3211429]
 [-1.9795457]
 [-2.6379485]]
</code></pre>
<h3 id="Complete-program"><a href="#Complete-program" class="headerlink" title="Complete program"></a>Complete program</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">x = tf.constant([[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>], [<span class="number">4</span>]], dtype=tf.float32)</span><br><span class="line">y_true = tf.constant([[<span class="number">0</span>], [-<span class="number">1</span>], [-<span class="number">2</span>], [-<span class="number">3</span>]], dtype=tf.float32)</span><br><span class="line"></span><br><span class="line">linear_model = tf.layers.Dense(units=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">y_pred = linear_model(x)</span><br><span class="line">loss = tf.losses.mean_squared_error(labels=y_true, predictions=y_pred)</span><br><span class="line"></span><br><span class="line">optimizer = tf.train.GradientDescentOptimizer(<span class="number">0.01</span>)</span><br><span class="line">train = optimizer.minimize(loss)</span><br><span class="line"></span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line"></span><br><span class="line">sess = tf.Session()</span><br><span class="line">sess.run(init)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">  _, loss_value = sess.run((train, loss))</span><br><span class="line">  <span class="comment">#print(loss_value)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sess.run(y_pred))</span><br></pre></td></tr></table></figure>

<pre><code>[[-0.5594496]
 [-1.2710916]
 [-1.9827336]
 [-2.6943758]]
</code></pre>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://tensorflow.google.cn/guide/low_level_intro">intro</a></li>
</ul>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><ul>
<li>20181026: created.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://kezunlin.me/blog/python-with-as-statement/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kezunlin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kezunlin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/python-with-as-statement/" class="post-title-link" itemprop="url">python with-as statement</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-23 12:21:00" itemprop="dateCreated datePublished" datetime="2018-10-23T12:21:00+08:00">2018-10-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-14 13:39:28" itemprop="dateModified" datetime="2024-10-14T13:39:28+08:00">2024-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Guide"><a href="#Guide" class="headerlink" title="Guide"></a>Guide</h2><h3 id="file-example"><a href="#file-example" class="headerlink" title="file example"></a>file example</h3><p>读取文件处理传统写法,需要确保文件正常打开之后，即使出现异常，也能够正常关闭。写法不够优雅。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    file = <span class="built_in">open</span>(<span class="string">&quot;./12.txt&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;can not open file&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    data = file.read()</span><br><span class="line">    <span class="comment"># ... do somethings</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;exception&quot;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;OK. close file&quot;</span>)</span><br><span class="line">    file.close()</span><br></pre></td></tr></table></figure>
<p>with语句时用于对try except finally 的优化，让代码更加美观。同时确保即使执行异常，finally中的语句也可以执行。</p>
<h3 id="with-as-重写"><a href="#with-as-重写" class="headerlink" title="with-as 重写"></a>with-as 重写</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./1.txt&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    data = file.read()</span><br></pre></td></tr></table></figure>

<h3 id="with-as-原理"><a href="#with-as-原理" class="headerlink" title="with-as 原理"></a>with-as 原理</h3><p>基本思想是with所求值的对象必须有一个<code>__enter__()</code>方法，一个<code>__exit__()</code>方法。</p>
<p>原理：</p>
<ol>
<li>with后面的语句被求值后返回对象A; </li>
<li>调用对象A的<code>__enter__()</code>方法将返回值赋给as后面的变量B；</li>
<li>执行with后面的代码块;</li>
<li>当with后面的代码块全部被执行完之后（或者由于抛出异常没有正常习执行完毕），最终都会调用A对象的<code>__exit__()</code>方法进行清理工作。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Sample</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;In __enter__()&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Foo&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, <span class="built_in">type</span>, value, trace</span>):</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;In __exit__()&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sample</span>():</span><br><span class="line">    <span class="keyword">return</span> Sample()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> get_sample() <span class="keyword">as</span> s:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;sample:&quot;</span>, s</span><br></pre></td></tr></table></figure>
<p>output </p>
<pre><code>In __enter__()
sample: Foo
In __exit__()
</code></pre>
<p>steps:</p>
<ol>
<li>执行with后面的语句get_sample()返回对象sample</li>
<li>执行sample对象的<code>__enter__()</code>方法，返回string类型的”Foo”赋值给as后面的s变量</li>
<li>执行代码块，打印变量”sample”的值为 “Foo”</li>
<li>代码块执行完毕，调用sample对象的<code>__exit__()</code>方法进行清理工作</li>
</ol>
<h3 id="with-处理异常"><a href="#with-处理异常" class="headerlink" title="with 处理异常"></a>with 处理异常</h3><p>with除了可以进行清理工作之外，真正强大之处是可以处理异常。Sample类的<code>__exit__</code>方法有三个参数：<code>val</code>, <code>type</code> 和 <code>trace</code>。 这些参数在异常处理中相当有用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Sample</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, <span class="built_in">type</span>, value, trace</span>):</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;type:&quot;</span>, <span class="built_in">type</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;value:&quot;</span>, value</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;trace:&quot;</span>, trace</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">self</span>):</span><br><span class="line">        bar = <span class="number">1</span>/<span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> bar + <span class="number">10</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> Sample() <span class="keyword">as</span> sample:</span><br><span class="line">    sample.do_something()</span><br></pre></td></tr></table></figure>
<p>output </p>
<pre><code>type: &lt;type &#39;exceptions.ZeroDivisionError&#39;&gt;
value: integer division or modulo by zero
trace: &lt;traceback object at 0x0000000004A5AA08&gt;

ZeroDivisionErrorTraceback (most recent call last)
&lt;ipython-input-9-282d3906c5ac&gt; in &lt;module&gt;()
     13 
     14 with Sample() as sample:
---&gt; 15     sample.do_something()

&lt;ipython-input-9-282d3906c5ac&gt; in do_something(self)
      9 
     10     def do_something(self):
---&gt; 11         bar = 1/0
     12         return bar + 10
     13 

ZeroDivisionError: integer division or modulo by zero
</code></pre>
<p>在执行代码块<code>sample.do_something()</code>的时候由于异常抛出，与之关联的type，value和stack trace传给<code>__exit__()</code>方法，因此抛出的<code>ZeroDivisionError</code>异常被打印出来了。</p>
<h3 id="file-对象"><a href="#file-对象" class="headerlink" title="file 对象"></a>file 对象</h3><p>python中的file对象已经实现了<code>__enter__()</code>和<code>__exit__()</code>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;./1.txt&quot;</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.__enter__()</span><br></pre></td></tr></table></figure>




<pre><code>&lt;open file &#39;./1.txt&#39;, mode &#39;r&#39; at 0x00000000049FF030&gt;
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.read(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.__exit__()</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.read(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>


<pre><code>ValueErrorTraceback (most recent call last)

&lt;ipython-input-19-d0e1662399bb&gt; in &lt;module&gt;()
----&gt; 1 file.read(1)


ValueError: I/O operation on closed file
</code></pre>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/DswCnblog/p/6126588.html">python with as的用法</a></li>
</ul>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><ul>
<li>20181023: created.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://kezunlin.me/blog/Superdog-tutorial-on-windows-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kezunlin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kezunlin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/Superdog-tutorial-on-windows-10/" class="post-title-link" itemprop="url">install and use Superdog to encrypt program on windows 10</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-18 17:25:00" itemprop="dateCreated datePublished" datetime="2018-10-18T17:25:00+08:00">2018-10-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-14 13:39:28" itemprop="dateModified" datetime="2024-10-14T13:39:28+08:00">2024-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/cpp/" itemprop="url" rel="index"><span itemprop="name">cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Guide"><a href="#Guide" class="headerlink" title="Guide"></a>Guide</h2><h3 id="Superdog-soft"><a href="#Superdog-soft" class="headerlink" title="Superdog soft"></a>Superdog soft</h3><p>2个dog:</p>
<ul>
<li>开发狗：Superdog公司给客户公司(kezunlin)提供的开发狗，包含公司的vendor_code，相当于管理员。不要遗失。</li>
<li>超级狗：可以通过软件写入feature_id交付用户。可以有多个超级狗。</li>
</ul>
<p>如何给超级狗写入特征id?</p>
<blockquote>
<p>提示：写入特征之前，必须确保开发狗+超级狗都连接在电脑。</p>
</blockquote>
<p>（1）安装windows版本加密狗软件到<code>C:\Program Files (x86)\SafeNet\SuperDog\2.3\</code>。<br>（2）在线下载开发商代码。<br>（3）打开授权管理工具，添加特征。例如feature_id&#x3D;101,然后编程到超级狗。</p>
<blockquote>
<p>开发商代码会写入vendor_code到<code>C:\Program Files (x86)\SafeNet\SuperDog\2.3\VendorCodes\BYAUY.hvc</code></p>
</blockquote>
<h3 id="Superdog-sample"><a href="#Superdog-sample" class="headerlink" title="Superdog sample"></a>Superdog sample</h3><p>参见 <code>C:\Program Files (x86)\SafeNet\SuperDog\2.3\Samples\Licensing\C</code></p>
<h3 id="Superdog-C-SDK"><a href="#Superdog-C-SDK" class="headerlink" title="Superdog C SDK"></a>Superdog C SDK</h3><p>从API中整理出C版本的SDK，供后面使用。</p>
<pre><code>Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        2014/6/30      8:43           9521 dog_api.h
-a----       2016/11/10     19:10        3297280 dog_windows_3150436.dll
-a----       2016/11/10     19:10           5668 dog_windows_3150436.lib
-a----       2016/11/10     19:10        3632128 dog_windows_x64_3150436.dll
-a----       2016/11/10     19:10           5530 dog_windows_x64_3150436.lib
</code></pre>
<h3 id="superdog-config-cmake"><a href="#superdog-config-cmake" class="headerlink" title="superdog-config.cmake"></a>superdog-config.cmake</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(SUPERDOG_FOUND <span class="keyword">TRUE</span>) <span class="comment"># auto </span></span><br><span class="line"><span class="keyword">set</span>(SUPERDOG_VERSION <span class="number">2.3</span>.<span class="number">0</span>)</span><br><span class="line"><span class="keyword">set</span>(SUPERDOG_ROOT_DIR <span class="string">&quot;C:/car_libs/superdog-c-2.3&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_path</span>(SUPERDOG_INCLUDE_DIR NAMES superdog/dog_api.h PATHS <span class="string">&quot;$&#123;SUPERDOG_ROOT_DIR&#125;/include&quot;</span>) </span><br><span class="line"><span class="keyword">mark_as_advanced</span>(SUPERDOG_INCLUDE_DIR) <span class="comment"># show entry in cmake-gui</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">find_library</span>(SUPERDOG_LIBRARY NAMES dog_windows_x64_3150436.lib PATHS <span class="string">&quot;$&#123;SUPERDOG_ROOT_DIR&#125;/lib&quot;</span>) </span><br><span class="line"><span class="keyword">mark_as_advanced</span>(SUPERDOG_LIBRARY) <span class="comment"># show entry in cmake-gui</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># use xxx_INCLUDE_DIRS and xxx_LIBRARIES in CMakeLists.txt</span></span><br><span class="line"><span class="keyword">set</span>(SUPERDOG_INCLUDE_DIRS <span class="variable">$&#123;SUPERDOG_INCLUDE_DIR&#125;</span> )</span><br><span class="line"><span class="keyword">set</span>(SUPERDOG_LIBRARIES <span class="variable">$&#123;SUPERDOG_LIBRARY&#125;</span> )</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>( <span class="string">&quot;superdog-config.cmake &quot;</span> <span class="variable">$&#123;SUPERDOG_ROOT_DIR&#125;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- kzl in-article ad -->
<p><ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-5653382914441020"
     data-ad-slot="7925631830"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>




<h2 id="Code-Example"><a href="#Code-Example" class="headerlink" title="Code Example"></a>Code Example</h2><h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><h3 id="MyDogApiImpl-h"><a href="#MyDogApiImpl-h" class="headerlink" title="MyDogApiImpl.h"></a>MyDogApiImpl.h</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;superdog/dog_api.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;errorprinter.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDogApiImpl</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">MyDogApiImpl</span>(<span class="type">int</span> feature_id, <span class="type">const</span> std::string&amp; vendor_code);</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">login</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">logout</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">dog_handle_t</span>   handle;</span><br><span class="line">	<span class="type">int</span> m_feature_id;</span><br><span class="line">	std::string m_vendor_code;</span><br><span class="line"></span><br><span class="line">	ErrorPrinter err;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="MyDogApiImpl-cpp"><a href="#MyDogApiImpl-cpp" class="headerlink" title="MyDogApiImpl.cpp"></a>MyDogApiImpl.cpp</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mydog_api_impi.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">MyDogApiImpl::<span class="built_in">MyDogApiImpl</span>(<span class="type">int</span> feature_id, <span class="type">const</span> std::string&amp; vendor_code)</span><br><span class="line">&#123;</span><br><span class="line">	m_feature_id = feature_id;</span><br><span class="line">	m_vendor_code = vendor_code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyDogApiImpl::login</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">dog_status_t</span> status = <span class="built_in">dog_login</span>(</span><br><span class="line">		m_feature_id,</span><br><span class="line">		(<span class="type">dog_vendor_code_t</span> *)m_vendor_code.<span class="built_in">c_str</span>(),</span><br><span class="line">		&amp;handle</span><br><span class="line">	);</span><br><span class="line">	err.<span class="built_in">printError</span>(status);</span><br><span class="line">	<span class="keyword">return</span> (<span class="type">int</span>)status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyDogApiImpl::logout</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">dog_status_t</span> status = <span class="built_in">dog_logout</span>(handle);</span><br><span class="line">	err.<span class="built_in">printError</span>(status);</span><br><span class="line">	<span class="keyword">return</span> (<span class="type">int</span>)status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="test"><a href="#test" class="headerlink" title="test"></a>test</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gtest/gtest.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glog/logging.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mydog/mydog.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">test_api</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> feature_id = <span class="number">111</span>;</span><br><span class="line">	std::string vendor_code = <span class="string">&quot;xxx&quot;</span>; <span class="comment">// from `VendorCodes\BYAUY.hvc`</span></span><br><span class="line">	</span><br><span class="line">	<span class="function">MyDogApi <span class="title">dog</span><span class="params">(feature_id, vendor_code)</span></span>;</span><br><span class="line">	<span class="type">int</span> status = dog.<span class="built_in">login</span>(); <span class="comment">// 0  OK, other failed (feature id error, vendor_code error, NO SuperDog)</span></span><br><span class="line"></span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;status = &quot;</span> &lt;&lt; status &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> status2 = dog.<span class="built_in">logout</span>();</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;status2 = &quot;</span> &lt;&lt; status2 &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST</span>(test, test_api) &#123;</span><br><span class="line">	<span class="built_in">test_api</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Python-version-supported"><a href="#Python-version-supported" class="headerlink" title="Python version supported"></a>Python version supported</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mydog_api.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUILD_PYTHON_MYDOG</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> BUILD_PYTHON_MYDOG</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> i + j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Pet</span> &#123;</span><br><span class="line">	<span class="built_in">Pet</span>(<span class="type">const</span> std::string &amp;name) : <span class="built_in">name</span>(name) &#123; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">setName</span><span class="params">(<span class="type">const</span> std::string &amp;name_)</span> </span>&#123; name = name_; &#125;</span><br><span class="line">	<span class="function"><span class="type">const</span> std::string &amp;<span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> name; &#125;</span><br><span class="line"></span><br><span class="line">	std::string name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(mydog, m)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// optional module docstring</span></span><br><span class="line">	m.<span class="built_in">doc</span>() = <span class="string">&quot;mydog plugin for python &quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// FUNCTIONS</span></span><br><span class="line">	<span class="comment">// expose add function, and add keyword arguments and default arguments</span></span><br><span class="line">	m.<span class="built_in">def</span>(<span class="string">&quot;add&quot;</span>, &amp;add, <span class="string">&quot;A function which adds two numbers&quot;</span>, py::<span class="built_in">arg</span>(<span class="string">&quot;i&quot;</span>) = <span class="number">1</span>, py::<span class="built_in">arg</span>(<span class="string">&quot;j&quot;</span>) = <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// DATA</span></span><br><span class="line">	<span class="comment">// exporting variables</span></span><br><span class="line">	m.<span class="built_in">attr</span>(<span class="string">&quot;the_answer&quot;</span>) = <span class="number">42</span>;</span><br><span class="line">	py::object world = py::<span class="built_in">cast</span>(<span class="string">&quot;World&quot;</span>);</span><br><span class="line">	m.<span class="built_in">attr</span>(<span class="string">&quot;what&quot;</span>) = world;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// CLASSES</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	py::class_&lt;Pet&gt;(m, &quot;Pet&quot;)</span></span><br><span class="line"><span class="comment">	.def(py::init&lt;const std::string &amp;&gt;())</span></span><br><span class="line"><span class="comment">	.def(&quot;setName&quot;, &amp;Pet::setName)</span></span><br><span class="line"><span class="comment">	.def(&quot;getName&quot;, &amp;Pet::getName);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// MyDog</span></span><br><span class="line">	py::<span class="built_in">class_</span>&lt;MyDogApi&gt;(m, <span class="string">&quot;MyDogApi&quot;</span>)</span><br><span class="line">		.<span class="built_in">def</span>(py::<span class="built_in">init</span>&lt;<span class="type">int</span>, <span class="type">const</span> std::string &amp;&gt;())</span><br><span class="line">		.<span class="built_in">def</span>(<span class="string">&quot;login&quot;</span>, &amp;MyDogApi::login)</span><br><span class="line">		.<span class="built_in">def</span>(<span class="string">&quot;logout&quot;</span>, &amp;MyDogApi::logout);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">// =====================1</span></span><br><span class="line"><span class="comment">pybind11_add_module($&#123;PYMYDOG_TARGET&#125;</span></span><br><span class="line"><span class="comment">$&#123;HEADER_FILES&#125;</span></span><br><span class="line"><span class="comment">$&#123;SOURCE_FILES&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># supder dog (dog_login,dog_logout)</span></span><br><span class="line"><span class="comment">$&#123;SUPERDOG_LIBRARIES&#125;</span></span><br><span class="line"><span class="comment">)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// =====================2</span></span><br><span class="line"><span class="comment">add_library($&#123;PYMYDOG_TARGET&#125; MODULE</span></span><br><span class="line"><span class="comment">$&#123;HEADER_FILES&#125;</span></span><br><span class="line"><span class="comment">$&#123;SOURCE_FILES&#125;</span></span><br><span class="line"><span class="comment">)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">target_link_libraries($&#123;PYMYDOG_TARGET&#125;</span></span><br><span class="line"><span class="comment">pybind11::module</span></span><br><span class="line"><span class="comment">$&#123;SUPERDOG_LIBRARIES&#125;</span></span><br><span class="line"><span class="comment">)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// BUILD_PYTHON_MYDOG</span></span></span><br></pre></td></tr></table></figure>

<h3 id="cmake-for-C-version"><a href="#cmake-for-C-version" class="headerlink" title="cmake for C++ version"></a>cmake for C++ version</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(SUPERDOG REQUIRED) <span class="comment"># user-defined supderdog 2.3</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;SUPERDOG_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;MYDOG_TARGET&#125;</span> </span><br><span class="line">	<span class="variable">$&#123;HEADER_FILES&#125;</span></span><br><span class="line">	<span class="variable">$&#123;SOURCE_FILES&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span> (<span class="variable">$&#123;MYDOG_TARGET&#125;</span>   </span><br><span class="line">	<span class="variable">$&#123;SUPERDOG_LIBRARIES&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="cmake-for-Python-version"><a href="#cmake-for-Python-version" class="headerlink" title="cmake for Python version"></a>cmake for Python version</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(SUPERDOG REQUIRED) <span class="comment"># user-defined supderdog 2.3</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;SUPERDOG_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(pybind11 CONFIG REQUIRED)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;pybind11_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;MYDOG_TARGET&#125;</span> </span><br><span class="line">	<span class="variable">$&#123;HEADER_FILES&#125;</span></span><br><span class="line">	<span class="variable">$&#123;SOURCE_FILES&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span> (<span class="variable">$&#123;MYDOG_TARGET&#125;</span>   </span><br><span class="line">	pybind11::module</span><br><span class="line">	<span class="variable">$&#123;SUPERDOG_LIBRARIES&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>rename <code>mydog.dll</code> to <code>mydog.pyd</code></p>
</blockquote>
<h3 id="test-pymydog"><a href="#test-pymydog" class="headerlink" title="test pymydog"></a>test pymydog</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mydog <span class="comment"># mydog.pyd</span></span><br><span class="line"></span><br><span class="line">feature_id = <span class="number">111</span></span><br><span class="line">vendor_code = <span class="string">&quot;xxx&quot;</span></span><br><span class="line"></span><br><span class="line">dog = mydog.MyDogApi(feature_id,vendor_code)</span><br><span class="line"><span class="built_in">print</span>(dog.login())</span><br><span class="line"><span class="built_in">print</span>(dog.logout())</span><br></pre></td></tr></table></figure>

<p>with files</p>
<pre><code>dog_windows_x64_3150436.dll
mydog.py
mydog.pyd
</code></pre>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><ul>
<li>20181022: created.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://kezunlin.me/blog/compile-cryptopp-7-0-on-windows-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kezunlin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kezunlin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/compile-cryptopp-7-0-on-windows-10/" class="post-title-link" itemprop="url">compile and install cryptopp 7.0 on windows 10</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-18 16:24:00" itemprop="dateCreated datePublished" datetime="2018-10-18T16:24:00+08:00">2018-10-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-14 13:39:28" itemprop="dateModified" datetime="2024-10-14T13:39:28+08:00">2024-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/cpp/" itemprop="url" rel="index"><span itemprop="name">cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Guide"><a href="#Guide" class="headerlink" title="Guide"></a>Guide</h2><ul>
<li>windows 10 64-bit</li>
<li>crypto++ 7.0 </li>
<li>vs 2015</li>
</ul>
<h3 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h3><p>download <a target="_blank" rel="noopener" href="https://github.com/weidai11/cryptopp/archive/CRYPTOPP_7_0_0.zip">crypto++ 7.0</a></p>
<p>open <code>cryptest.sln</code> with <code>Visual Studio 2015</code></p>
<p>change <code>Windows SDK Version</code> from <code>8.1</code> to <code>10.0</code></p>
<p><img src="https://kezunlin.me/images/posts/635233-20181018145051821-1901848873.png" alt="png"></p>
<p>compile <code>cryptodll</code> with <code>Release x64</code> and we get <code>cryptopp.dll</code> and <code>cryptopp.lib</code><br><img src="https://kezunlin.me/images/posts/635233-20181018150015903-521843035.png" alt="png"></p>
<h3 id="sdk"><a href="#sdk" class="headerlink" title="sdk"></a>sdk</h3><p>copy headers to <code>include</code>, copy libs to <code>lib</code> and dlls to <code>dll</code> like this:</p>
<p><img src="https://kezunlin.me/images/posts/635233-20181018151300297-2070989019.png" alt="png"></p>
<h3 id="cryptopp-config-cmake"><a href="#cryptopp-config-cmake" class="headerlink" title="cryptopp-config.cmake"></a>cryptopp-config.cmake</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CRYPTOPP_FOUND <span class="keyword">TRUE</span>) <span class="comment"># auto </span></span><br><span class="line"><span class="keyword">set</span>(CRYPTOPP_VERSION <span class="number">7.0</span>.<span class="number">0</span>)</span><br><span class="line"><span class="keyword">set</span>(CRYPTOPP_ROOT_DIR <span class="string">&quot;C:/car_libs/cryptopp-7.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_path</span>(CRYPTOPP_INCLUDE_DIR NAMES cryptopp/aes.h PATHS <span class="string">&quot;$&#123;CRYPTOPP_ROOT_DIR&#125;/include&quot;</span>) </span><br><span class="line"><span class="keyword">mark_as_advanced</span>(CRYPTOPP_INCLUDE_DIR) <span class="comment"># show entry in cmake-gui</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">find_library</span>(CRYPTOPP_LIBRARY NAMES cryptopp.lib PATHS <span class="string">&quot;$&#123;CRYPTOPP_ROOT_DIR&#125;/lib&quot;</span>) </span><br><span class="line"><span class="keyword">mark_as_advanced</span>(CRYPTOPP_LIBRARY) <span class="comment"># show entry in cmake-gui</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># use xxx_INCLUDE_DIRS and xxx_LIBRARIES in CMakeLists.txt</span></span><br><span class="line"><span class="keyword">set</span>(CRYPTOPP_INCLUDE_DIRS <span class="variable">$&#123;CRYPTOPP_INCLUDE_DIR&#125;</span> )</span><br><span class="line"><span class="keyword">set</span>(CRYPTOPP_LIBRARIES <span class="variable">$&#123;CRYPTOPP_LIBRARY&#125;</span> )</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>( <span class="string">&quot;cryptopp-config.cmake &quot;</span> <span class="variable">$&#123;CRYPTOPP_ROOT_DIR&#125;</span>)</span><br></pre></td></tr></table></figure>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- kzl in-article ad -->
<p><ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-5653382914441020"
     data-ad-slot="7925631830"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>




<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>see <code>cryptopp-7.0/dlltest.cpp</code></p>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><h4 id="cipher-h"><a href="#cipher-h" class="headerlink" title="cipher.h"></a>cipher.h</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( disable: 4275 ) </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( disable: 4819 )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cryptopp/dll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cryptopp/cryptlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cryptopp/aes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cryptopp/filters.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cryptopp/modes.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="built_in">USING_NAMESPACE</span>(CryptoPP)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CipherApiImpl</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">enum</span> <span class="title class_">MODE</span></span><br><span class="line">	&#123;</span><br><span class="line">		AES,</span><br><span class="line">		DES</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">CipherApiImpl</span>(MODE mode = MODE::AES);</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">get_filesize</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filename)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">save</span><span class="params">(<span class="type">const</span> std::string&amp; filepath, <span class="type">const</span> std::string&amp; str)</span></span>;</span><br><span class="line">	<span class="function">std::string <span class="title">load</span><span class="params">(<span class="type">const</span> std::string&amp; filepath)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">std::string <span class="title">encrypt_string</span><span class="params">(<span class="type">const</span> std::string&amp; plain_text)</span></span>;</span><br><span class="line">	<span class="function">std::string <span class="title">decrypt_string</span><span class="params">(<span class="type">const</span> std::string&amp; cipher_text)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">std::string <span class="title">encrypt_file</span><span class="params">(<span class="type">const</span> std::string&amp; infile)</span></span>;</span><br><span class="line">	<span class="function">std::string <span class="title">decrypt_file</span><span class="params">(<span class="type">const</span> std::string&amp; infile)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">encrypt_file</span><span class="params">(<span class="type">const</span> std::string&amp; infile, <span class="type">const</span> std::string&amp; outfile)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">decrypt_file</span><span class="params">(<span class="type">const</span> std::string&amp; infile, <span class="type">const</span> std::string&amp; outfile)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function">std::string <span class="title">tohex</span><span class="params">(<span class="type">const</span> <span class="type">char</span>&amp; c)</span></span>;</span><br><span class="line">	<span class="function">std::string <span class="title">tohexs</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">char</span> <span class="title">tochar</span><span class="params">(<span class="type">const</span> <span class="type">char</span>&amp; hex1, <span class="type">const</span> <span class="type">char</span>&amp; hex2)</span></span>;</span><br><span class="line">	<span class="function">std::string <span class="title">tochars</span><span class="params">(<span class="type">const</span> std::string&amp; hex)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">// 32 + 16</span></span><br><span class="line">	<span class="type">const</span> byte aes_key[CryptoPP::AES::MAX_KEYLENGTH] = &#123;</span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,</span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,</span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,</span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">const</span> byte aes_iv[CryptoPP::AES::BLOCKSIZE] = &#123;</span><br><span class="line">		<span class="number">0x12</span>,<span class="number">0x34</span>,<span class="number">0x56</span>,<span class="number">0x78</span>,<span class="number">0x90</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,</span><br><span class="line">		<span class="number">0x12</span>,<span class="number">0x34</span>,<span class="number">0x56</span>,<span class="number">0x78</span>,<span class="number">0x90</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 24+8</span></span><br><span class="line">	<span class="type">const</span> byte des_key[CryptoPP::DES_EDE3::MAX_KEYLENGTH] = &#123;</span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,</span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,</span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">const</span> byte des_iv[CryptoPP::DES_EDE3::BLOCKSIZE] = &#123;</span><br><span class="line">		<span class="number">0x12</span>,<span class="number">0x34</span>,<span class="number">0x56</span>,<span class="number">0x78</span>,<span class="number">0x90</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	CryptoPP::CFB_FIPS_Mode&lt;CryptoPP::AES&gt;::Encryption aes_encryption;</span><br><span class="line">	CryptoPP::CFB_FIPS_Mode&lt;CryptoPP::AES&gt;::Decryption aes_decryption;</span><br><span class="line"></span><br><span class="line">	CryptoPP::CFB_FIPS_Mode&lt;CryptoPP::DES_EDE3&gt;::Encryption des_encryption;</span><br><span class="line">	CryptoPP::CFB_FIPS_Mode&lt;CryptoPP::DES_EDE3&gt;::Decryption des_decryption;</span><br><span class="line"></span><br><span class="line">	MODE m_mode;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="cipher-cpp"><a href="#cipher-cpp" class="headerlink" title="cipher.cpp"></a>cipher.cpp</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cipher_api_impl.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">CipherApiImpl::<span class="built_in">CipherApiImpl</span>(MODE mode)</span><br><span class="line">&#123;</span><br><span class="line">	m_mode = mode;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// for des</span></span><br><span class="line">	des_encryption.<span class="built_in">SetKeyWithIV</span>(des_key, <span class="built_in">sizeof</span>(des_key), des_iv);</span><br><span class="line">	des_decryption.<span class="built_in">SetKeyWithIV</span>(des_key, <span class="built_in">sizeof</span>(des_key), des_iv);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// for aes</span></span><br><span class="line">	aes_encryption.<span class="built_in">SetKeyWithIV</span>(aes_key, <span class="built_in">sizeof</span>(aes_key), aes_iv);</span><br><span class="line">	aes_decryption.<span class="built_in">SetKeyWithIV</span>(aes_key, <span class="built_in">sizeof</span>(aes_key), aes_iv);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> region hex/char</span></span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">CipherApiImpl::tohex</span><span class="params">(<span class="type">const</span> <span class="type">char</span>&amp; c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	00,01,02,...0F   [0,1,2,...15]</span></span><br><span class="line"><span class="comment">	10,11,12,...1F   [16,17,...31]</span></span><br><span class="line"><span class="comment">	...</span></span><br><span class="line"><span class="comment">	F0,F1,F2,...FF	[240,241,...255]</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	char ch[2] = &#123; 0 &#125;;</span></span><br><span class="line"><span class="comment">	sprintf(ch, &quot;%02x&quot;, static_cast&lt;byte&gt;(c)); //  char ---&gt; 16 hex</span></span><br><span class="line"><span class="comment">	return std::string(ch);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> HEX[] = <span class="string">&quot;0123456789ABCDEF&quot;</span>;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> HEX_BASE = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	std::string c_hex;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> uc = (<span class="type">unsigned</span> <span class="type">char</span>)(c);</span><br><span class="line">	<span class="type">int</span> a = uc / HEX_BASE;</span><br><span class="line">	<span class="type">int</span> b = uc % HEX_BASE;</span><br><span class="line">	c_hex.<span class="built_in">push_back</span>(HEX[a]);</span><br><span class="line">	c_hex.<span class="built_in">push_back</span>(HEX[b]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> c_hex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">CipherApiImpl::tohexs</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> HEX[] = <span class="string">&quot;0123456789ABCDEF&quot;</span>;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> HEX_BASE = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	std::string hex_result;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; str.<span class="built_in">size</span>(); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		std::string c_hex;</span><br><span class="line">		<span class="type">int</span> uc = (<span class="type">unsigned</span> <span class="type">char</span>)(str[i]);</span><br><span class="line">		<span class="type">int</span> a = uc / HEX_BASE;</span><br><span class="line">		<span class="type">int</span> b = uc % HEX_BASE;</span><br><span class="line">		c_hex.<span class="built_in">push_back</span>(HEX[a]);</span><br><span class="line">		c_hex.<span class="built_in">push_back</span>(HEX[b]);</span><br><span class="line"></span><br><span class="line">		hex_result += c_hex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> hex_result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span> <span class="title">CipherApiImpl::tochar</span><span class="params">(<span class="type">const</span> <span class="type">char</span>&amp; hex1, <span class="type">const</span> <span class="type">char</span>&amp; hex2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> HEX_BASE = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> h1 = (<span class="type">int</span>)hex1;</span><br><span class="line">	<span class="type">int</span> h2 = (<span class="type">int</span>)hex2;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// F1 ===&gt; 16,1===&gt;15*16+1 = 241 ===&gt; char</span></span><br><span class="line">	<span class="type">char</span> uc = (<span class="type">char</span>)(h1*HEX_BASE + h2);</span><br><span class="line">	<span class="keyword">return</span> uc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">CipherApiImpl::tochars</span><span class="params">(<span class="type">const</span> std::string&amp; hex)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (hex.<span class="built_in">size</span>() % <span class="number">2</span> != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	std::map&lt;<span class="type">char</span>, <span class="type">int</span>&gt; hex_int = &#123;</span><br><span class="line">		&#123; <span class="string">&#x27;0&#x27;</span> , <span class="number">0</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;1&#x27;</span>, <span class="number">1</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;2&#x27;</span>, <span class="number">2</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;3&#x27;</span>, <span class="number">3</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;4&#x27;</span>, <span class="number">4</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;5&#x27;</span>, <span class="number">5</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;6&#x27;</span>, <span class="number">6</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;7&#x27;</span>, <span class="number">7</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;8&#x27;</span>, <span class="number">8</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;9&#x27;</span>, <span class="number">9</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;A&#x27;</span>, <span class="number">10</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;B&#x27;</span>, <span class="number">11</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;C&#x27;</span>, <span class="number">12</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;D&#x27;</span>, <span class="number">13</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;E&#x27;</span>, <span class="number">14</span> &#125;,</span><br><span class="line">		&#123; <span class="string">&#x27;F&#x27;</span>, <span class="number">15</span> &#125;,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	std::string char_result;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> HEX_BASE = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; hex.<span class="built_in">size</span>(); i += <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">int</span> h1 = hex_int.<span class="built_in">at</span>(hex[i]);   <span class="comment">// &#x27;F&#x27; ===&gt;15</span></span><br><span class="line">		<span class="type">int</span> h2 = hex_int.<span class="built_in">at</span>(hex[i + <span class="number">1</span>]); <span class="comment">// &#x27;1&#x27;===&gt;1</span></span><br><span class="line"></span><br><span class="line">										 <span class="comment">// F1 ===&gt; 15,1===&gt;15*16+1 = 241 ===&gt; char</span></span><br><span class="line">										 <span class="comment">//std::cout &lt;&lt; &quot;===============\n&quot;;</span></span><br><span class="line">		<span class="type">char</span> uc = (<span class="type">char</span>)(h1*HEX_BASE + h2);</span><br><span class="line">		<span class="comment">//std::cout &lt;&lt; h1 &lt;&lt;&quot;,&quot;&lt;&lt;h2 &lt;&lt; std::endl;</span></span><br><span class="line">		<span class="comment">//std::cout &lt;&lt; uc &lt;&lt; std::endl;</span></span><br><span class="line">		char_result += uc;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> char_result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> region encrypt_string and decrypt_string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CipherApiImpl::get_filesize</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filename)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">stat</span> f_stat;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">stat</span>(filename, &amp;f_stat) == <span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> f_stat.st_size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">std::string load_text_not_use(const std::string&amp; filepath)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">std::string str;</span></span><br><span class="line"><span class="comment">ifstream in(filepath, ios::in | ios::binary);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">std::string line;</span></span><br><span class="line"><span class="comment">std::string content;</span></span><br><span class="line"><span class="comment">while (getline(in, line))</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">//std::cout &lt;&lt; &quot;line.size()=&quot; &lt;&lt; line.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">if (line.size() &gt; 0) &#123;</span></span><br><span class="line"><span class="comment">content += line + &quot;\n&quot;;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">line.clear();</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">in.close();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">return content;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CipherApiImpl::save</span><span class="params">(<span class="type">const</span> std::string&amp; filepath, <span class="type">const</span> std::string&amp; str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">ofstream <span class="title">out</span><span class="params">(filepath, ios::out | ios::binary)</span></span>; <span class="comment">// binary mode (default text mode)</span></span><br><span class="line">	out.<span class="built_in">write</span>(str.<span class="built_in">c_str</span>(), str.<span class="built_in">length</span>());</span><br><span class="line">	out.<span class="built_in">close</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">CipherApiImpl::load</span><span class="params">(<span class="type">const</span> std::string&amp; filepath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> filesize = <span class="built_in">get_filesize</span>(filepath.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span> *buffer = <span class="keyword">new</span> <span class="type">char</span>[filesize];</span><br><span class="line"></span><br><span class="line">	<span class="function">ifstream <span class="title">in</span><span class="params">(filepath, ios::in | ios::binary)</span></span>; <span class="comment">// binary mode (default text mode)</span></span><br><span class="line">	in.<span class="built_in">read</span>(buffer, filesize);</span><br><span class="line">	in.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// std::string content(buffer); // ERROR for binary file</span></span><br><span class="line">	std::string content;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; filesize; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		content.<span class="built_in">push_back</span>(buffer[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">delete</span>[] buffer;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//==========================================================================</span></span><br><span class="line"><span class="comment">std::string cipher_text;</span></span><br><span class="line"><span class="comment">CryptoPP::AES::CipherApiImpl aesEncryption(key, CryptoPP::AES::MAX_KEYLENGTH);</span></span><br><span class="line"><span class="comment">CryptoPP::CBC_Mode_ExternalCipher::CipherApiImpl cbcEncryption(aesEncryption, iv);</span></span><br><span class="line"><span class="comment">CryptoPP::StreamTransformationFilter stfEncryptor(cbcEncryption, new CryptoPP::StringSink(cipher_text));</span></span><br><span class="line"><span class="comment">stfEncryptor.Put(reinterpret_cast&lt;const unsigned char*&gt;(plain_text.c_str()), plain_text.length());</span></span><br><span class="line"><span class="comment">stfEncryptor.MessageEnd();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">std::string cipher_text_hex = tohexs(cipher_text);</span></span><br><span class="line"><span class="comment">return cipher_text_hex;</span></span><br><span class="line"><span class="comment">//==========================================================================</span></span><br><span class="line"><span class="comment">CryptoPP::AES::Decryption aesDecryption(key, CryptoPP::AES::MAX_KEYLENGTH);</span></span><br><span class="line"><span class="comment">CryptoPP::CBC_Mode_ExternalCipher::Decryption cbcDecryption(aesDecryption, iv);</span></span><br><span class="line"><span class="comment">CryptoPP::StreamTransformationFilter stfDecryptor(cbcDecryption, new CryptoPP::StringSink(decryptedText));</span></span><br><span class="line"><span class="comment">stfDecryptor.Put(reinterpret_cast&lt;const unsigned char*&gt;(cipher_text.c_str()), cipher_text.size());</span></span><br><span class="line"><span class="comment">stfDecryptor.MessageEnd();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">return decrypted_text;</span></span><br><span class="line"><span class="comment">//==========================================================================</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">byte ciphertext[24];</span></span><br><span class="line"><span class="comment">byte decrypted[24];</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">CFB_FIPS_Mode&lt;DES_EDE3&gt;::Encryption encryption_DES_EDE3_CFB;</span></span><br><span class="line"><span class="comment">encryption_DES_EDE3_CFB.SetKeyWithIV(key, sizeof(key), iv);</span></span><br><span class="line"><span class="comment">encryption_DES_EDE3_CFB.ProcessString(ciphertext, plaintext, 24);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">CFB_FIPS_Mode&lt;DES_EDE3&gt;::Decryption decryption_DES_EDE3_CFB;</span></span><br><span class="line"><span class="comment">decryption_DES_EDE3_CFB.SetKeyWithIV(key, sizeof(key), iv);</span></span><br><span class="line"><span class="comment">decryption_DES_EDE3_CFB.ProcessString(decrypted, ciphertext, 24);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">CipherApiImpl::encrypt_string</span><span class="params">(<span class="type">const</span> std::string&amp; plain_text)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">size_t</span> size = plain_text.<span class="built_in">size</span>();</span><br><span class="line">	<span class="type">const</span> byte* in_byte = (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*)(plain_text.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">	byte* out_byte = <span class="keyword">new</span> byte[size];</span><br><span class="line"></span><br><span class="line">	des_encryption.<span class="built_in">ProcessString</span>(out_byte, in_byte, size);</span><br><span class="line"></span><br><span class="line">	std::string cipher_text;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		cipher_text.<span class="built_in">push_back</span>(out_byte[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">delete</span>[] out_byte;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> cipher_text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">CipherApiImpl::decrypt_string</span><span class="params">(<span class="type">const</span> std::string&amp; cipher_text)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">size_t</span> size = cipher_text.<span class="built_in">size</span>();</span><br><span class="line">	<span class="type">const</span> byte* in_byte = (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*)(cipher_text.<span class="built_in">c_str</span>());</span><br><span class="line">	byte* out_byte = <span class="keyword">new</span> byte[size];</span><br><span class="line"></span><br><span class="line">	des_decryption.<span class="built_in">ProcessString</span>(out_byte, in_byte, size);</span><br><span class="line"></span><br><span class="line">	std::string plain_text;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		plain_text.<span class="built_in">push_back</span>(out_byte[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">delete</span>[] out_byte;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> plain_text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">CipherApiImpl::encrypt_file</span><span class="params">(<span class="type">const</span> std::string&amp; infile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::string plain_text = <span class="built_in">load</span>(infile);</span><br><span class="line">	std::string cipher_text = <span class="built_in">encrypt_string</span>(plain_text);</span><br><span class="line">	<span class="keyword">return</span> cipher_text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">CipherApiImpl::decrypt_file</span><span class="params">(<span class="type">const</span> std::string&amp; infile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::string cipher_text = <span class="built_in">load</span>(infile);</span><br><span class="line">	std::string plain_text = <span class="built_in">decrypt_string</span>(cipher_text);</span><br><span class="line">	<span class="keyword">return</span> plain_text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CipherApiImpl::encrypt_file</span><span class="params">(<span class="type">const</span> std::string&amp; infile, <span class="type">const</span> std::string&amp; outfile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::string cipher_text_hex = <span class="built_in">encrypt_file</span>(infile);</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">save</span>(outfile, cipher_text_hex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CipherApiImpl::decrypt_file</span><span class="params">(<span class="type">const</span> std::string&amp; infile, <span class="type">const</span> std::string&amp; outfile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::string plain_text = <span class="built_in">decrypt_file</span>(infile);</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">save</span>(outfile, plain_text);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> endregion</span></span><br></pre></td></tr></table></figure>

<h4 id="test-cpp"><a href="#test-cpp" class="headerlink" title="test.cpp"></a>test.cpp</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gtest/gtest.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glog/logging.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( disable: 4819 ) </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( disable: 4244 ) </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( disable: 4267 ) </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cipher/cipher.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">test_cipher_api</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CipherApi cipher;</span><br><span class="line"></span><br><span class="line">	std::string text = <span class="string">&quot;[hello zhuzhu dashen !]\n[1234567]\n[123]\n1\n&quot;</span>;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;text : &quot;</span> &lt;&lt; text &lt;&lt; endl;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;text size: &quot;</span> &lt;&lt; text.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">	cipher.<span class="built_in">save</span>(<span class="string">&quot;./tmp/text.txt&quot;</span>, text);</span><br><span class="line"></span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;==============encrypt/decrypt string======================\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">	std::string cipherHex = cipher.<span class="built_in">encrypt_string</span>(text);</span><br><span class="line">	<span class="comment">//cout &lt;&lt; &quot;cipher : &quot; &lt;&lt; cipherHex &lt;&lt; endl;</span></span><br><span class="line">	cipher.<span class="built_in">save</span>(<span class="string">&quot;./tmp/cipherHex.txt&quot;</span>, cipherHex);</span><br><span class="line"></span><br><span class="line">	std::string text2 = cipher.<span class="built_in">decrypt_string</span>(cipherHex);</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;text2 : &quot;</span> &lt;&lt; text2 &lt;&lt; endl;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;text2 size: &quot;</span> &lt;&lt; text<span class="number">2.</span><span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">	cipher.<span class="built_in">save</span>(<span class="string">&quot;./tmp/text2.txt&quot;</span>, text2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// load_text </span></span><br><span class="line">	std::string text_load = cipher.<span class="built_in">load</span>(<span class="string">&quot;./tmp/text2.txt&quot;</span>);</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;text_load : &quot;</span> &lt;&lt; text_load &lt;&lt; endl;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;text_load size: &quot;</span> &lt;&lt; text_load.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// encrypt/decrypt text file</span></span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;==============encrypt/decrypt text file======================\n&quot;</span>;</span><br><span class="line">	cipher.<span class="built_in">encrypt_file</span>(<span class="string">&quot;./tmp/text.txt&quot;</span>, <span class="string">&quot;./tmp/text_encryption.txt&quot;</span>);</span><br><span class="line">	cipher.<span class="built_in">decrypt_file</span>(<span class="string">&quot;./tmp/cipherHex.txt&quot;</span>, <span class="string">&quot;./tmp/cipherHex_decryption.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// encrypt/decrypt prototxt </span></span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;==============encrypt/decrypt prototxt======================\n&quot;</span>;</span><br><span class="line">	cipher.<span class="built_in">encrypt_file</span>(<span class="string">&quot;./tmp/small/deploy.prototxt&quot;</span>, <span class="string">&quot;./tmp/small/deploy_encryption.prototxt&quot;</span>);</span><br><span class="line">	cipher.<span class="built_in">decrypt_file</span>(<span class="string">&quot;./tmp/small/deploy_encryption.prototxt&quot;</span>, <span class="string">&quot;./tmp/small/deploy_new.prototxt&quot;</span>);</span><br><span class="line"></span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;==============encrypt/decrypt caffemodel======================\n&quot;</span>;</span><br><span class="line">	cipher.<span class="built_in">encrypt_file</span>(<span class="string">&quot;./tmp/small/recon__iter_140000.caffemodel&quot;</span>, <span class="string">&quot;./tmp/small/recon__iter_140000_encryption.caffemodel&quot;</span>);</span><br><span class="line">	cipher.<span class="built_in">decrypt_file</span>(<span class="string">&quot;./tmp/small/recon__iter_140000_encryption.caffemodel&quot;</span>, <span class="string">&quot;./tmp/small/recon__iter_140000_new.caffemodel&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST</span>(cipher_test, test_cipher_api) &#123;</span><br><span class="line">	<span class="built_in">test_cipher_api</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="CMakeLists-txt"><a href="#CMakeLists-txt" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(CRYPTOPP REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">MESSAGE</span>( [Main] <span class="string">&quot; CRYPTOPP_INCLUDE_DIRS = $&#123;CRYPTOPP_INCLUDE_DIRS&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">MESSAGE</span>( [Main] <span class="string">&quot; CRYPTOPP_LIBRARIES = $&#123;CRYPTOPP_LIBRARIES&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;CRYPTOPP_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span> (demo  <span class="variable">$&#123;CRYPTOPP_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/weidai11/cryptopp/releases">cryptopp github</a></li>
</ul>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><ul>
<li>20181018: created.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://kezunlin.me/blog/linux-xargs-tutorial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kezunlin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kezunlin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/linux-xargs-tutorial/" class="post-title-link" itemprop="url">how to use linux xargs command</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-20 16:44:00" itemprop="dateCreated datePublished" datetime="2018-09-20T16:44:00+08:00">2018-09-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-14 13:39:28" itemprop="dateModified" datetime="2024-10-14T13:39:28+08:00">2024-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Guide"><a href="#Guide" class="headerlink" title="Guide"></a>Guide</h2><h3 id="param-input-stdin"><a href="#param-input-stdin" class="headerlink" title="param input &amp;&amp; stdin"></a>param input &amp;&amp; stdin</h3><p>linux命令可以从两个地方读取要处理的内容</p>
<ul>
<li>通过命令行参数输入,通过main函数的argc,argv获取</li>
<li>标准输入stdin,通过scanf或者cin获取</li>
</ul>
<p>然后产生输出</p>
<ul>
<li>标准输出stdout,通过printf或者cout输出</li>
</ul>
<p>命令类型</p>
<ul>
<li>部分命令可以接受参数输入＋标准输入stdin，比如cat、grep等。</li>
<li>部分命令只接受参数输入，不接受标准输入stdin，比如kill、rm等。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>*argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// argc, argv</span></span><br><span class="line">    <span class="comment">// cin, scanf </span></span><br><span class="line">    <span class="comment">// cout printf</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>指定参数输入，则从参数输入读取内容;<br>未指定或者在命令的最后使用 <code>-</code>则从标准输入读取内容;<br>管道<code>｜</code>将stdout重定向到后续命令的stdin;</p>
</blockquote>
<h3 id="cat-grep"><a href="#cat-grep" class="headerlink" title="cat&#x2F;grep"></a>cat&#x2F;grep</h3><h4 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h4><ul>
<li><p>指定参数输入1.txt，文件存在【从参数输入读取】</p>
<pre><code>cat 1.txt
hello world 
</code></pre>
</li>
<li><p>指定参数输入1.txt，文件不存在【从参数输入读取】</p>
<pre><code>cat 1.txt2
cat: 1.txt2: No such file or directory
</code></pre>
</li>
<li><p>未指定参数输入【从stdin读取】</p>
<pre><code>cat
hello
hello
^C
</code></pre>
</li>
<li><p>使用<code>-</code>【从stdin读取】</p>
<pre><code>cat -
hello
hello
^C
</code></pre>
</li>
<li><p>指定参数输入1.txt，文件存在+使用<code>-</code>【从参数输入读取+stdin读取】</p>
<pre><code>cat 1.txt -
hello world 
hello
hello
^C
</code></pre>
</li>
</ul>
<h4 id="cat-pipe"><a href="#cat-pipe" class="headerlink" title="cat + pipe"></a>cat + pipe</h4><ul>
<li><p>指定参数输入1.txt，文件存在 + stdin【only从参数输入读取】</p>
<pre><code>echo &#39;hello&#39; | cat 1.txt
hello world 
</code></pre>
</li>
<li><p>指定参数输入1.txt，文件不存在【only从参数输入读取】</p>
<pre><code>echo &#39;hello&#39; | cat 1.txt2
cat: 1.txt2: No such file or directory
</code></pre>
</li>
<li><p>未指定参数输入【从stdin读取】</p>
<pre><code>echo &#39;hello&#39; |　cat
hello
</code></pre>
</li>
<li><p>使用<code>-</code>【从stdin读取】</p>
<pre><code>echo &#39;hello&#39; |　cat -
hello
</code></pre>
</li>
<li><p>指定参数输入1.txt，文件存在+使用<code>-</code>【从参数输入读取+stdin读取】</p>
<pre><code>echo &#39;hello&#39; |　cat 1.txt -
hello world 
hello
</code></pre>
</li>
</ul>
<h4 id="grep-pipe"><a href="#grep-pipe" class="headerlink" title="grep + pipe"></a>grep + pipe</h4><ul>
<li><p>指定参数输入1.txt，文件存在 + stdin【only从参数输入读取】</p>
<pre><code>echo &#39;hello&#39; | grep &#39;hello&#39; 1.txt
hello world 
</code></pre>
</li>
<li><p>指定参数输入1.txt，文件存在+使用<code>-</code>【从参数输入读取+stdin读取】</p>
<pre><code>echo &#39;hello&#39; | grep &#39;hello&#39; 1.txt -
1.txt:hello world
(standard input):hello
</code></pre>
</li>
</ul>
<h3 id="kill-rm"><a href="#kill-rm" class="headerlink" title="kill&#x2F;rm"></a>kill&#x2F;rm</h3><ul>
<li><p>kill不接受stdin</p>
<pre><code>echo &#39;516&#39; | kill
kill: usage: kill [-s sigspec | -n signum | -sigspec] pid | jobspec ... or kill -l [sigspec]
</code></pre>
</li>
<li><p>rm 不接受stdin</p>
<pre><code>  echo &#39;test&#39; | rm -f
</code></pre>
</li>
</ul>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- kzl in-article ad -->
<p><ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-5653382914441020"
     data-ad-slot="7925631830"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>




<h3 id="xargs"><a href="#xargs" class="headerlink" title="xargs"></a>xargs</h3><p>如何实现<code>echo &#39;516&#39; | kill</code>类似的效果?</p>
<ul>
<li><p>method 1</p>
<pre><code>  kill `ps -ef | grep &#39;xxx&#39;`  # same as   kill $pid
</code></pre>
</li>
<li><p>method 2</p>
<pre><code>  for pid in $(ps -aux | grep &quot;some search&quot; | awk &#39;&#123;print $2&#125;&#39;); 				do kill -9 $pid; 
  done 
</code></pre>
</li>
<li><p>method 3</p>
<pre><code>  ps -ef | grep &#39;xxx&#39; | xargs kill
</code></pre>
</li>
</ul>
<p>xargs命令可以通过管道接受字符串，并将接收到的字符串通过空格分割成许多参数(默认情况下是通过空格分割) 然后将参数传递给其后面的命令，作为后面命令的命令行参数输入</p>
<blockquote>
<p>xargs可以实现命令的参数输入</p>
</blockquote>
<h3 id="xargs-vs-pipe"><a href="#xargs-vs-pipe" class="headerlink" title="xargs vs pipe"></a>xargs vs pipe</h3><ul>
<li><p>pipe 使得–help成为cat的stdin</p>
<pre><code>$ echo &#39;--help&#39; | cat 
--help
</code></pre>
</li>
<li><p>xargs使得–help成为cat的命令行参数输入,等价于 <code>cat --help</code></p>
<pre><code>$ echo &#39;--help&#39; | xargs cat 
Usage: cat [OPTION]... [FILE]...
Concatenate FILE(s) to standard output.

With no FILE, or when FILE is -, read standard input.

  -A, --show-all           equivalent to -vET
  -b, --number-nonblank    number nonempty output lines, overrides -n
  -e                       equivalent to -vE
  -E, --show-ends          display $ at end of each line
  -n, --number             number all output lines
  -s, --squeeze-blank      suppress repeated empty output lines
  -t                       equivalent to -vT
  -T, --show-tabs          display TAB characters as ^I
  -u                       (ignored)
  -v, --show-nonprinting   use ^ and M- notation, except for LFD and TAB
      --help     display this help and exit
      --version  output version information and exit

Examples:
  cat f - g  Output f&#39;s contents, then standard input, then g&#39;s contents.
  cat        Copy standard input to standard output.

GNU coreutils online help: &lt;http://www.gnu.org/software/coreutils/&gt;
Full documentation at: &lt;http://www.gnu.org/software/coreutils/cat&gt;
or available locally via: info &#39;(coreutils) cat invocation&#39;
</code></pre>
</li>
</ul>
<p><code>echo &#39;1.txt 2.txt&#39; | xargs cat</code> 等价于 <code>cat 1.txt 2.txt</code></p>
<h3 id="xargs-options"><a href="#xargs-options" class="headerlink" title="xargs options"></a>xargs options</h3><h4 id="d-选项"><a href="#d-选项" class="headerlink" title="-d 选项"></a>-d 选项</h4><p>默认情况下xargs将其标准输入中的内容以空白(包括空格、Tab、回车换行等)分割成多个之后当作命令行参数传递给其后面的命令，并运行之，我们可以使用 -d 命令指定分隔符</p>
<pre><code>  echo &#39;11@22@33&#39; | xargs echo 
  11@22@33

  echo &#39;11@22@33&#39; | xargs -d &#39;@&#39; echo 
  11 22 33
</code></pre>
<p>等价于 </p>
<pre><code>echo 11 22 33
</code></pre>
<h4 id="p-选项"><a href="#p-选项" class="headerlink" title="-p 选项"></a>-p 选项</h4><p>使用该选项之后xargs并不会马上执行其后面的命令，而是输出即将要执行的完整的命令(包括命令以及传递给命令的命令行参数)，询问是否执行，输入 y 才继续执行，否则不执行。这种方式可以清楚的看到执行的命令是什么样子，也就是xargs传递给命令的参数是什么</p>
<pre><code>  echo &#39;11@22@33&#39; | xargs -p -d &#39;@&#39;  echo 
  echo 11 22 33
   ?...yes
  11 22 33
</code></pre>
<h4 id="n-选项"><a href="#n-选项" class="headerlink" title="-n 选项"></a>-n 选项</h4><p>该选项表示将xargs生成的命令行参数，每次传递几个参数给其后面的命令执行，例如如果xargs从标准输入中读入内容，然后以分隔符分割之后生成的命令行参数有10个，使用 -n 3 之后表示一次传递给xargs后面的命令是3个参数，因为一共有10个参数，所以要执行4次，才能将参数用完。</p>
<pre><code>  echo &#39;11@22@33@44@55@66@77@88@99@00&#39; | xargs -d &#39;@&#39; -n 3 echo 
  11 22 33
  44 55 66
  77 88 99
  00
</code></pre>
<p>等价于</p>
<pre><code>echo 11 22 33
echo 44 55 66
echo 77 88 99
echo 00
</code></pre>
<p>使用<code>-n 1</code>得到类似于对循环处理的结果。</p>
<p>默认一次送入n个参数，一次处理完毕</p>
<pre><code>ls *.txt | xargs -p cat 
cat 1.txt 2.txt 3.txt ?...y
111
222
333


等价与
cat 1.txt 2.txt 3.txt
111
222
333
</code></pre>
<p><code>-n 1</code>一次送入１个参数，相当于循环处理了３次，每次处理一个文件</p>
<pre><code>ls *.txt | xargs -n 1 -p cat 
cat 1.txt ?...y
111
cat 2.txt ?...y
222
cat 3.txt ?...y
333


 
等价与
cat 1.txt
111

cat ２.txt
222

cat ３.txt
333
</code></pre>
<h4 id="E-选项"><a href="#E-选项" class="headerlink" title="-E 选项"></a>-E 选项</h4><p>有的系统的xargs版本可能是<code>-e  eof-str</code>,该选项指定一个字符串，当xargs解析出多个命令行参数的时候，如果搜索到-e指定的命令行参数，则只会将-e指定的命令行参数之前的参数(不包括-e指定的这个参数)传递给xargs后面的命令</p>
<pre><code>echo &#39;11 22 33 44&#39; | xargs -E &#39;33&#39; echo 
11 22 
</code></pre>
<blockquote>
<p>-E只有在xargs不指定-d或者-0的时候有效<br>-0 选项表示以 ‘\0’ 为分隔符，一般与find结合使用<br>-0 等同于 -d ‘\0’</p>
</blockquote>
<p>使用<code>-d</code> </p>
<pre><code>  echo &#39;11@22@33@44@55@66@77@88@99@00 aa 33 bb&#39; | xargs -E &#39;33&#39; -d &#39;@&#39; -p  echo
  xargs: warning: the -E option has no effect if -0 or -d is used.

  echo 11 22 33 44 55 66 77 88 99 00 aa 33 bb
   ?...y
  11 22 33 44 55 66 77 88 99 00 aa 33 bb
</code></pre>
<p>不使用<code>-d</code></p>
<pre><code>  echo &#39;11@22@33@44@55@66@77@88@99@00 aa 33 bb&#39; | xargs -E &#39;33&#39; -p  echo
  echo 11@22@33@44@55@66@77@88@99@00 aa ?...y
  11@22@33@44@55@66@77@88@99@00 aa
</code></pre>
<h4 id="0-find"><a href="#0-find" class="headerlink" title="-0 &amp;&amp; find"></a>-0 &amp;&amp; find</h4><pre><code>find . -name &quot;*.txt&quot;
./2.txt
./3.txt
./1.txt     =&gt; 默认情况下find的输出结果是每条记录后面加上换行，也就是每条记录是一个新行

find . -name &quot;*.txt&quot; -print0
./2.txt./3.txt./1.txt     =&gt; 加上 -print0 参数表示find输出的每条结果后面加上 &#39;\0&#39; 而不是换行

find . -name &quot;*.txt&quot; -print0 | xargs -0 echo 
./2.txt ./3.txt ./1.txt

等同于
find . -name &quot;*.txt&quot; -print0 | xargs -d &#39;\0&#39; echo 
./2.txt ./3.txt ./1.txt

默认使用空白分隔符(换行符也是)
find . -name &quot;*.txt&quot;  | xargs  echo 
./2.txt ./3.txt ./1.txt
</code></pre>
<h3 id="xargs-as-loop"><a href="#xargs-as-loop" class="headerlink" title="xargs as loop"></a>xargs as loop</h3><p>one image at once </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python text_recognition.py  --east frozen_east_text_detection.pb --image 1.jpg</span><br></pre></td></tr></table></figure>

<p>for loop </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find roi/ -name <span class="string">&quot;*.jpg&quot;</span> | xargs -n 1 python text_recognition.py  --east frozen_east_text_detection.pb --image </span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> roi/*.jpg | xargs -n 1 python text_recognition.py  --east frozen_east_text_detection.pb --image </span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangqiguo/p/6464234.html">xargs命令详解，xargs与管道的区别</a></li>
</ul>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><ul>
<li>20180920:  created.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">kezunlin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">181</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">213</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kezunlin</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
